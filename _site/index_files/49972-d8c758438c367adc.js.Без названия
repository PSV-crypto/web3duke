!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="55fd0261-3b38-469a-aa9b-32075f586ddd",e._sentryDebugIdIdentifier="sentry-dbid-55fd0261-3b38-469a-aa9b-32075f586ddd")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[49972],{2376:(e,t,s)=>{s.d(t,{ru:()=>y,_c:()=>f,sS:()=>I,v5:()=>p});var n=s(28245),o=s(38541),i=s.n(o),r=s(88382),a=s(65146),l=s(6132),d=s(75500);let c=l.z.object({personaId:l.z.string(),prompt:l.z.string().optional()}),u=l.z.object({personaPresets:l.z.array(c)}),h=l.z.union([l.z.literal("imageGen"),l.z.literal("search"),l.z.literal("think"),l.z.literal("deepsearch")]),m=l.z.object({personaId:l.z.string(),name:l.z.string(),systemPromptName:l.z.string(),disclaimer:l.z.string().optional(),disabledTools:h.array(),prompt:l.z.string().optional()});function p(){let{stage:e}=(0,n.Sf)(),{t}=(0,a.Bd)("base"),s=function(){let e=(0,d.h)();return(0,r.useMemo)(()=>{var t;let s=null==(t=e.PERSONAS)?void 0:t.value;if(!s)return{personaPresets:[]};let n=u.safeParse(s);return n.success?n.data:{personaPresets:[]}},[e.PERSONAS])}(),o=(0,r.useMemo)(()=>({news:t("persona-name.news","Latest News"),romance:t("persona-name.romance","Companion"),unhinged:t("persona-name.unhinged","Unhinged Comedian"),friend:t("persona-name.friend","Loyal Friend"),tutor:t("persona-name.tutor","Homework Helper"),doctor:t("persona-name.doctor_with_quotes",'Grok "Doc"'),therapist:t("persona-name.therapist_with_quotes",'"Therapist"'),scientist:t("persona-name.scientist","Scientist"),coder:t("persona-name.coder","Coder")}),[t]),l=(0,r.useMemo)(()=>g.map(e=>({personaId:e,name:o[e],systemPromptName:v[e],disabledTools:[],prompt:function(e,t){let s=t.personaPresets.find(t=>t.personaId===e);return(null==s?void 0:s.prompt)||""}(e,s)})).filter(t=>!y.includes(t.personaId)||"nopass"!==e).map(e=>m.safeParse(e)).filter(e=>e.success).map(e=>e.data),[e,o,s]),c=(0,r.useMemo)(()=>i().keyBy(l,e=>e.personaId),[l]),h=(0,r.useCallback)(e=>{if(!g.includes(e))return;let t=c[e];if(t)return t},[c]),p=(0,r.useCallback)(e=>{if(!e||!e.personaId||!g.includes(e.personaId))return;let t=c[e.personaId];if(t)return t},[c]);return{personas:l,personaById:c,getPersonaForConversation:p,getPersonaFromId:h}}let g=["news","romance","unhinged","friend","tutor","doctor","therapist"],v={doctor:"grok3_personality_medical_advisor",news:"grok3_personality_latest_news",friend:"grok3_personality_loyal_friend",tutor:"grok3_personality_homework_helper",romance:"grok3_personality_romance_me",unhinged:"grok3_personality_unhinged_comedian",therapist:"grok3_personality_trusted_therapist",scientist:"grok3_personality_science_geek",coder:"grok3_personality_cracked_coder"};function f(e){if(!e)return;let t=i().invert(v)[e];if(I(t))return t}function I(e){return!!e&&g.includes(e)}let y=["romance","unhinged"]},4295:(e,t,s)=>{s.d(t,{c:()=>o,f:()=>i});var n=s(88382);function o(){let[e,t]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{let e=()=>{let e=navigator.userAgent||navigator.vendor;t(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e))};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),e}function i(){let e=navigator.userAgent||navigator.vendor;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e)}},13103:(e,t,s)=>{s.d(t,{Cf:()=>u,Es:()=>m,L3:()=>p,ZJ:()=>d,c7:()=>h,eB:()=>i,lG:()=>a,rr:()=>g,zM:()=>l});var n=s(79342),o=s(61312),i=s(53592),r=s(88382);let a=i.bL,l=i.l9,d=i.ZL;i.bm;let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)(i.hJ,{ref:t,className:(0,o.cn)("fixed inset-0 z-[100] bg-overlay backdrop-blur-[2px] duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});c.displayName=i.hJ.displayName;let u=r.forwardRef((e,t)=>{let{className:s,overlayClassname:r,children:a,...l}=e;return(0,n.jsxs)(d,{children:[(0,n.jsx)(c,{className:r}),(0,n.jsx)(i.UC,{ref:t,className:(0,o.cn)("fixed left-[50%] top-[50%] z-[100] grid translate-x-[-50%] translate-y-[-50%] gap-4 bg-surface-base dark:border dark:border-border-l1 duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",s),onCloseAutoFocus:e=>{e.preventDefault(),document.body.style.pointerEvents=""},...l,children:a})]})});u.displayName=i.UC.displayName;let h=e=>{let{className:t,...s}=e;return(0,n.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};h.displayName="DialogHeader";let m=e=>{let{className:t,...s}=e;return(0,n.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};m.displayName="DialogFooter";let p=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)(i.hE,{ref:t,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",s),...r})});p.displayName=i.hE.displayName;let g=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)(i.VY,{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",s),...r})});g.displayName=i.VY.displayName},17014:(e,t,s)=>{s.d(t,{Oj5:()=>w,Qtr:()=>c,c11:()=>h,nfr:()=>p,VAL:()=>v,id:()=>I,vjv:()=>S});var n=s(79342),o=s(40409),i=s(37953);function r(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,i.QP)((0,o.$)(t))}var a=s(88382);let l=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",...e,children:(0,n.jsx)("path",{d:"m10.828 12 4.95 4.95-1.414 1.415L8 12l6.364-6.364 1.414 1.414z"})}),d=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 33 33",...e,children:(0,n.jsx)("path",{fill:"currentColor",d:"m13.237 21.04 11.082-8.19c.543-.4 1.32-.244 1.578.38 1.363 3.288.754 7.241-1.957 9.955-2.71 2.714-6.482 3.31-9.93 1.954l-3.765 1.745c5.401 3.697 11.96 2.782 16.059-1.324 3.251-3.255 4.258-7.692 3.317-11.693l.008.009c-1.365-5.878.336-8.227 3.82-13.031q.123-.17.247-.345l-4.585 4.59v-.014L13.234 21.044M10.95 23.031c-3.877-3.707-3.208-9.446.1-12.755 2.446-2.449 6.454-3.448 9.952-1.979L24.76 6.56c-.677-.49-1.545-1.017-2.54-1.387A12.465 12.465 0 0 0 8.675 7.901c-3.519 3.523-4.625 8.94-2.725 13.561 1.42 3.454-.907 5.898-3.251 8.364-.83.874-1.664 1.749-2.335 2.674l10.583-9.466"})}),c=e=>{let{"aria-label":t,className:s,color:o,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,n.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:o,...a},children:(0,n.jsx)(d,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};c.displayName="GrokLogoIcon";let u=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",...e,children:(0,n.jsx)("path",{d:"M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"})}),h=e=>{let{"aria-label":t,className:s,color:o,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,n.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:o,...a},children:(0,n.jsx)(u,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};h.displayName="PlusIcon";let m=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",style:{height:24,width:24,marginRight:0},viewBox:"0 0 122.8 122.8",...e,children:(0,n.jsx)("path",{fill:"currentColor",d:"M25.8 77.6c0 7.1-5.8 12.9-12.9 12.9S0 84.7 0 77.6s5.8-12.9 12.9-12.9h12.9zm6.5 0c0-7.1 5.8-12.9 12.9-12.9s12.9 5.8 12.9 12.9v32.3c0 7.1-5.8 12.9-12.9 12.9s-12.9-5.8-12.9-12.9zM45.2 25.8c-7.1 0-12.9-5.8-12.9-12.9S38.1 0 45.2 0s12.9 5.8 12.9 12.9v12.9zm0 6.5c7.1 0 12.9 5.8 12.9 12.9s-5.8 12.9-12.9 12.9H12.9C5.8 58.1 0 52.3 0 45.2s5.8-12.9 12.9-12.9zM97 45.2c0-7.1 5.8-12.9 12.9-12.9s12.9 5.8 12.9 12.9-5.8 12.9-12.9 12.9H97zm-6.5 0c0 7.1-5.8 12.9-12.9 12.9s-12.9-5.8-12.9-12.9V12.9C64.7 5.8 70.5 0 77.6 0s12.9 5.8 12.9 12.9zM77.6 97c7.1 0 12.9 5.8 12.9 12.9s-5.8 12.9-12.9 12.9-12.9-5.8-12.9-12.9V97zm0-6.5c-7.1 0-12.9-5.8-12.9-12.9s5.8-12.9 12.9-12.9h32.3c7.1 0 12.9 5.8 12.9 12.9s-5.8 12.9-12.9 12.9z"})}),p=e=>{let{"aria-label":t,className:s,color:o,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,n.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:o,...a},children:(0,n.jsx)(m,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};p.displayName="SlackLogoIcon";let g=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",...e,children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.712 4.33a9 9 0 0 1 1.652 1.306c.51.51.944 1.064 1.306 1.652M16.712 4.33l-3.448 4.138m3.448-4.138a9.01 9.01 0 0 0-9.424 0M19.67 7.288l-4.138 3.448m4.138-3.448a9.01 9.01 0 0 1 0 9.424m-4.138-5.976a3.7 3.7 0 0 0-.88-1.388 3.7 3.7 0 0 0-1.388-.88m2.268 2.268a3.77 3.77 0 0 1 0 2.528m-2.268-4.796a3.77 3.77 0 0 0-2.528 0m4.796 4.796a3.75 3.75 0 0 1-.88 1.388 3.7 3.7 0 0 1-1.388.88m2.268-2.268 4.138 3.448m0 0a9 9 0 0 1-1.306 1.652c-.51.51-1.064.944-1.652 1.306m0 0-3.448-4.138m3.448 4.138a9.01 9.01 0 0 1-9.424 0m5.976-4.138a3.77 3.77 0 0 1-2.528 0m0 0a3.7 3.7 0 0 1-1.388-.88 3.7 3.7 0 0 1-.88-1.388m2.268 2.268L7.288 19.67m0 0a9 9 0 0 1-1.652-1.306 9 9 0 0 1-1.306-1.652m0 0 4.138-3.448M4.33 16.712a9.01 9.01 0 0 1 0-9.424m4.138 5.976a3.77 3.77 0 0 1 0-2.528m0 0c.181-.506.475-.982.88-1.388a3.7 3.7 0 0 1 1.388-.88m-2.268 2.268L4.33 7.288m6.406 1.18L7.288 4.33m0 0a9 9 0 0 0-1.652 1.306A9 9 0 0 0 4.33 7.288"})}),v=e=>{let{"aria-label":t,className:s,color:o,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,n.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:o,...a},children:(0,n.jsx)(g,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};v.displayName="SupportIcon";let f=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",...e,children:(0,n.jsx)("path",{d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10m0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16m-1-5h2v2h-2zm0-8h2v6h-2z"})}),I=e=>{let{"aria-label":t,className:s,color:o,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,n.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:o,...a},children:(0,n.jsx)(f,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};I.displayName="WarningIcon";let y=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",...e,children:(0,n.jsx)("path",{d:"M8 2H1l8.26 11.015L1.45 22H4.1l6.388-7.349L16 22h7l-8.608-11.478L21.8 2h-2.65l-5.986 6.886zm9 18L5 4h2l12 16z"})}),S=e=>{let{"aria-label":t,className:s,color:o,size:i="medium"}=e,a="number"==typeof i?{height:i,width:i}:void 0;return(0,n.jsx)("span",{className:r("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:o,...a},children:(0,n.jsx)(y,{"aria-hidden":!t,"aria-label":t,className:r({"w-4 h-4":"x-small"===i,"w-5 h-5":"small"===i,"w-6 h-6":"medium"===i,"w-8 h-8":"large"===i,"w-full h-full":"fill"===i}),focusable:"false",style:{fill:"currentColor",...a}})})};S.displayName="XLogoIcon";let w=e=>{let{"aria-label":t,className:s,color:o,disabled:i,size:d="medium",type:c="button",...u}=e,h=(0,a.useRef)(null),m=null!=i?!!i:!t,p="number"==typeof d?{height:d,width:d}:void 0;return(0,n.jsx)("button",{...u,type:c,"aria-disabled":i,"aria-hidden":m,"aria-label":t,className:r("inline-flex items-center justify-center border-none bg-transparent hover:bg-muted/50 rounded-full p-0 m-0 appearance-none disabled:opacity-30",{"w-4 h-4":"x-small"===d,"w-5 h-5":"small"===d,"w-6 h-6":"medium"===d,"w-8 h-8":"large"===d,"w-full h-full":"fill"===d},s),"data-namespace":"@xai/icons","data-slot":"icon",disabled:i,ref:h,style:{color:o,...p},children:(0,n.jsx)(l,{className:r({"w-[1.125rem] h-[1.125rem]":"medium"===d,"w-[1.375rem] h-[1.375rem]":"large"===d,"w-3.5 h-3.5":"x-small"===d,"w-4 h-4":"small"===d,"w-full h-full":"fill"===d}),focusable:"false",style:{fill:"currentColor",...p}})})};w.displayName="ArrowLeftIconButton"},24994:(e,t,s)=>{s.d(t,{R:()=>d});var n=s(79342);s(88382);var o=s(13103),i=s(34500),r=s(41320),a=s(61312),l=s(65146);function d(e){let{open:t,setOpen:s,trigger:d,title:c,description:u,footer:h,children:m,contentClassName:p,headerClassName:g,footerClassName:v,titleClassName:f,descriptionClassName:I,blurBackground:y}=e,{t:S}=(0,l.Bd)();return!(0,r.Di)()&&t?(0,n.jsxs)(o.lG,{open:t,onOpenChange:s,children:[d&&(0,n.jsx)(o.zM,{asChild:!0,children:d}),(0,n.jsxs)(o.Cf,{className:(0,a.cn)("focus:outline-none rounded-none",p),overlayClassname:(0,a.cn)(y&&"backdrop-blur-lg"),"aria-describedby":void 0,children:[(0,n.jsxs)(o.c7,{className:(0,a.cn)(!c&&!u&&"sr-only",g),children:[(0,n.jsx)(o.L3,{className:f,children:null!=c?c:S("dialog.title","Dialog")}),u?(0,n.jsx)(o.rr,{className:I,children:u}):null]}),m,h?(0,n.jsx)(o.Es,{className:v,children:h}):null]})]}):(0,n.jsxs)(i._s,{open:t,onOpenChange:s,dismissible:!!s,children:[d&&(0,n.jsx)(i.Uz,{asChild:!0,children:d}),(0,n.jsxs)(i.zj,{className:(0,a.cn)("focus:outline-none",p,"max-w-none !rounded-b-none"),overlayClassName:(0,a.cn)(y&&"backdrop-blur-lg"),"aria-describedby":void 0,children:[(0,n.jsxs)(i.BE,{className:(0,a.cn)(!c&&!u&&"sr-only","p-0 text-left",g),children:[(0,n.jsx)(i.gk,{className:f,children:null!=c?c:S("dialog.title","Dialog")}),u?(0,n.jsx)(i.I6,{className:I,children:u}):null]}),m,h?(0,n.jsx)(i.tb,{className:(0,a.cn)("pt-2",v),children:h}):null]})]})}},28245:(e,t,s)=>{s.d(t,{Sf:()=>y,TL:()=>S});var n=s(79342),o=s(56691),i=s(24994);s(37931);var r=s(61312),a=s(20337),l=s(38541),d=s.n(l),c=s(32171),u=s.n(c),h=s(68332),m=s(44347),p=s(88382),g=s(65146),v=s(4890),f=s(17823),I=s(69648);d().range(1900,new Date().getFullYear()).map(e=>e.toString()).reverse();let y=(0,v.v)()((0,f.Zr)(e=>({stage:"start",setStage:t=>e({stage:t})}),{name:"age-verif"}));function S(e){let{onPass:t}=e,{t:s}=(0,g.Bd)("base"),{stage:l,setStage:d}=y(),{routeToConversation:c}=(0,h.o)(),{client:v}=(0,a.useStatsigClient)(),f=(0,p.useCallback)(()=>{v.logEvent("clicked_signin",void 0,{location:"age-verification"})},[v]),S=(0,p.useCallback)(()=>{d("pass"),null==t||t(),v.logEvent("selected_over_18","pass",{location:"over-18-verification"})},[t,v,d]),w=(0,p.useCallback)(()=>{d("nopass"),v.logEvent("selected_over_18","nopass",{location:"over-18-verification"})},[v,d]),b=(0,p.useCallback)(()=>{let{setShowAgeVerification:e}=m.C$.getState();e(!1),c(void 0)},[c]);return(0,n.jsxs)(i.R,{open:"pass"!==l,contentClassName:(0,r.cn)("focus:outline-0 focus-within:outline-0 gap-2","bg-background rounded-3xl","w-full md:w-5/6 lg:w-3/5 max-w-sm","flex flex-col","md:overflow-hidden","px-6 py-6"),blurBackground:!0,headerClassName:(0,r.cn)("nopass"===l&&"mb-4"),titleClassName:(0,r.cn)("nopass"===l&&"mb-1"),title:"nopass"===l?s("Restricted","Restricted"):"start"===l?s("Please confirm your age","Please confirm your age"):null,description:"nopass"===l?s("Restricted.description","Based on the information you provided you cannot use Grok image generation or 18+ personas."):"start"===l?s("Please confirm your age.description","In order to continue using Grok we need to confirm your age."):null,children:["start"===l&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex items-center justify-center gap-4 p-1",children:[(0,n.jsx)(o.$n,{className:"w-full",variant:"secondary",onClick:w,tabIndex:-1,children:s("I am not over 18","I am not over 18")}),(0,n.jsx)(o.$n,{className:"w-full",variant:"primary",onClick:S,children:s("I am 18 or older","I am 18 or older")})]}),(0,n.jsxs)("div",{className:"relative flex items-center justify-center w-full",children:[(0,n.jsx)(I.w,{className:"absolute -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2"}),(0,n.jsx)("p",{className:"relative px-2 py-1 mx-auto text-xs bg-background text-secondary",children:s("Or","Or")})]}),(0,n.jsx)(o.$n,{asChild:!0,variant:"secondary",size:"lg",onClick:f,children:(0,n.jsx)(u(),{href:"sign-in",children:s("Sign in or create an account","Sign in or create an account")})})]}),"nopass"===l&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(o.$n,{className:"w-full mt-2",variant:"primary",size:"lg",onClick:b,children:s("Start a new chat","Start a new chat")})})]})}},29938:(e,t,s)=>{s.d(t,{Uk:()=>c,X4:()=>d,jN:()=>p,yo:()=>g});var n=s(65258),o=s(38541),i=s.n(o),r=s(6132),a=s(88223);let l="custom_personality_id",d={personalityId:l,name:"Custom",prompt:"",description:"Responds to you as you please.",isPreset:!1};function c(e){return!!e&&(e===l||36===e.length)}function u(e){return{name:e.name,content:[{text:e.prompt}]}}function h(e){var t,s;return{personalityId:e.systemPromptId||"",name:e.name||d.name,prompt:(null==(s=e.content)||null==(t=s[0])?void 0:t.text)||"",description:d.description,isPreset:!1}}class m{constructor(e,t){this.set=e,this.get=t,this.promiseById={},this.byId={},this.list=[],this.draftPromptById={},this.upsertPersonality=(0,n.el)(this.set,"byId","personalityId"),this.appendPersonalities=(0,n.BC)(this.set,"byId","personalityId"),this.removePersonality=(0,n.TF)(this.set,"byId"),this.idsertPersonalityPromise=(0,n.q5)(this.set,"promiseById"),this.removePersonalityPromise=(0,n.TF)(this.set,"promiseById"),this.upsertDraftPrompt=(0,n.q5)(this.set,"draftPromptById"),this.fetchCreatePersonality=e=>{let t=this.get(),s=a.eb.systemPromptRepositoryCreateSystemPrompt({body:u(e)}).then(e=>{let t=h(e);return t.description=d.description,t}).then(e=>(t.upsertPersonality(e),t.idsertPersonalityPromise(s,e.personalityId),e));return s},this.fetchUpdatePersonality=e=>{let t=this.get(),s=a.eb.systemPromptRepositoryUpdateSystemPrompt({systemPromptId:e.personalityId,body:u(e)}).then(e=>h(e)).then(e=>(t.upsertPersonality(e),e));return t.idsertPersonalityPromise(s,e.personalityId),s},this.fetchDeletePersonality=e=>(this.get().removePersonality(e.personalityId),a.eb.systemPromptRepositoryDeleteSystemPrompt({systemPromptId:e.personalityId})),this.fetchListPersonalities=()=>{let e=this.get();return a.eb.systemPromptRepositoryListSystemPrompts({body:{pageSize:100}}).then(e=>{var t;return(null==(t=e.assets)?void 0:t.map(h))||[]}).then(t=>(e.appendPersonalities(t),e.set(e=>({promiseById:{...e.promiseById,...i().mapValues(i().keyBy(t,"personalityId"),e=>Promise.resolve(e))}})),t))},this.fetchGetPersonality=e=>{let t=this.get(),s=e.personalityId;if(s in t.promiseById)return t.promiseById[s];let n=a.eb.systemPromptRepositoryGetSystemPrompt({systemPromptId:s}).then(e=>h(e)).then(e=>(t.upsertPersonality(e),t.idsertPersonalityPromise(n,e.personalityId),e));return n}}}let p=(0,n.y$)(m,"usePersonalityStore");(0,n.lB)(p,"byId","list",Object.values);let g=r.z.object({personalityId:r.z.string(),name:r.z.string(),prompt:r.z.string(),description:r.z.string(),isPreset:r.z.boolean()});r.z.array(g)},34500:(e,t,s)=>{s.d(t,{BE:()=>h,I6:()=>g,Uz:()=>l,_s:()=>a,gk:()=>p,tb:()=>m,zj:()=>u});var n=s(79342),o=s(88382),i=s(49872),r=s(61312);let a=e=>{let{shouldScaleBackground:t=!0,...s}=e;return(0,n.jsx)(i._.Root,{shouldScaleBackground:t,...s})};a.displayName="Drawer";let l=i._.Trigger,d=i._.Portal;i._.Close;let c=o.forwardRef((e,t)=>{let{className:s,...o}=e;return(0,n.jsx)(i._.Overlay,{ref:t,className:(0,r.cn)("fixed inset-0 z-50 bg-black/20 dark:bg-black/80",s),...o})});c.displayName=i._.Overlay.displayName;let u=o.forwardRef((e,t)=>{let{className:s,overlayClassName:o,disableDrag:a,children:l,...u}=e;return(0,n.jsxs)(d,{children:[(0,n.jsx)(c,{className:o}),(0,n.jsxs)(i._.Content,{ref:t,className:(0,r.cn)("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[24px] bg-surface-base dark:border dark:border-border-l1",s),onCloseAutoFocus:e=>{e.preventDefault(),document.body.style.pointerEvents=""},...u,children:[a?null:(0,n.jsx)("div",{className:"flex-shrink-0 w-12 h-1 mx-auto mt-3 mb-0 rounded-full bg-secondary/80"}),l]})]})});u.displayName="DrawerContent";let h=e=>{let{className:t,...s}=e;return(0,n.jsx)("div",{className:(0,r.cn)("grid gap-1.5 p-4 text-center sm:text-left",t),...s})};h.displayName="DrawerHeader";let m=e=>{let{className:t,...s}=e;return(0,n.jsx)("div",{className:(0,r.cn)("mt-auto flex flex-col gap-2 p-4",t),...s})};m.displayName="DrawerFooter";let p=o.forwardRef((e,t)=>{let{className:s,...o}=e;return(0,n.jsx)(i._.Title,{ref:t,className:(0,r.cn)("text-lg font-semibold leading-none tracking-tight",s),...o})});p.displayName=i._.Title.displayName;let g=o.forwardRef((e,t)=>{let{className:s,...o}=e;return(0,n.jsx)(i._.Description,{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",s),...o})});g.displayName=i._.Description.displayName},36936:(e,t,s)=>{s.d(t,{V:()=>i});var n=s(65258);class o{constructor(e,t){this.set=e,this.get=t,this.models=[],this.unavailableModels=[],this.defaultAnonModelId="",this.defaultFreeModelId="",this.defaultProModelId="",this.modelById={},this.isPending=!1}}let i=(0,n.y$)(o,"useModelsStore")},37931:(e,t,s)=>{s.d(t,{bq:()=>u,eb:()=>m,gC:()=>h,l6:()=>d,yv:()=>c});var n=s(79342),o=s(30479),i=s(67811),r=s(82263),a=s(59346);s(88382);var l=s(61312);function d(e){let{...t}=e;return(0,n.jsx)(o.bL,{"data-slot":"select",...t})}function c(e){let{...t}=e;return(0,n.jsx)(o.WT,{"data-slot":"select-value",...t})}function u(e){let{className:t,size:s="default",children:r,...a}=e;return(0,n.jsxs)(o.l9,{"data-slot":"select-trigger","data-size":s,className:(0,l.cn)("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...a,children:[r,(0,n.jsx)(o.In,{asChild:!0,children:(0,n.jsx)(i.A,{className:"size-4 opacity-50"})})]})}function h(e){let{className:t,children:s,position:i="popper",...r}=e;return(0,n.jsxs)(o.UC,{"data-slot":"select-content",className:(0,l.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:i,...r,children:[(0,n.jsx)(p,{}),(0,n.jsx)(o.LM,{className:(0,l.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:s}),(0,n.jsx)(g,{})]})}function m(e){let{className:t,children:s,...i}=e;return(0,n.jsxs)(o.q7,{"data-slot":"select-item",className:(0,l.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...i,children:[(0,n.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,n.jsx)(o.VF,{children:(0,n.jsx)(r.A,{className:"size-4"})})}),(0,n.jsx)(o.p4,{children:s})]})}function p(e){let{className:t,...s}=e;return(0,n.jsx)(o.PP,{"data-slot":"select-scroll-up-button",className:(0,l.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,n.jsx)(a.A,{className:"size-4"})})}function g(e){let{className:t,...s}=e;return(0,n.jsx)(o.wn,{"data-slot":"select-scroll-down-button",className:(0,l.cn)("flex cursor-default items-center justify-center py-1",t),...s,children:(0,n.jsx)(i.A,{className:"size-4"})})}},38614:(e,t,s)=>{s.d(t,{aP:()=>D});var n=s(52959),o=s(58192),i=s(44845),r=s(83626),a=s(17703),l=s(33960),d=s(35021);class c{static getInstance(){return c.instance||(c.instance=new c),c.instance}startVoiceSession(e){let{sessionId:t,voiceId:s,personalityId:n,customInstructions:o,enableSearch:i,enableVision:r}=e,a=Date.now();this.currentSession={sessionId:t,requestId:null,startTime:a,connectionStartTime:a,voiceId:s,personalityId:n,customInstructions:o,enableSearch:i,enableVision:r,userTurns:0,assistantTurns:0,errors:[],personalityChanges:[],voiceChanges:[],manualMessagesSent:0},(0,d.$s)("voice_session_started",t,{sessionId:t,voiceId:s,personalityId:n||"none",customInstructions:o||"none",enableSearch:i.toString(),enableVision:r.toString()})}setRequestId(e){this.currentSession&&(this.currentSession.requestId=e)}trackConversationCreated(e){let{conversationId:t,connectionState:s}=e;if(!this.currentSession)return;let n=Date.now();(0,d.$s)("voice_conversation_created",this.currentSession.sessionId,{sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",conversationId:t||"unavailable",connectionState:s,timestamp:n.toString()})}trackConnectionReady(){if(!this.currentSession)return;let e=Date.now();this.currentSession.readyTime=e,this.currentSession.connectionStartTime&&(this.currentSession.connectionDuration=e-this.currentSession.connectionStartTime)}trackUserTurn(){this.currentSession&&this.currentSession.userTurns++}trackAssistantTurn(){this.currentSession&&this.currentSession.assistantTurns++}trackManualMessage(){this.currentSession&&this.currentSession.manualMessagesSent++}trackPersonalityChange(e){let{fromPersonality:t,toPersonality:s,fromCustomInstructions:n,toCustomInstructions:o}=e;if(!this.currentSession)return;let i={fromPersonality:t,toPersonality:s,fromCustomInstructions:n,toCustomInstructions:o,timestamp:Date.now()};this.currentSession.personalityChanges.push(i),this.currentSession.personalityId=s,this.currentSession.customInstructions=o,(0,d.$s)("voice_personality_changed",void 0,{sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",fromPersonality:t||"none",toPersonality:s||"none",fromCustomInstructions:n||"none",toCustomInstructions:o||"none",changeCount:this.currentSession.personalityChanges.length.toString()})}trackVoiceChange(e){let{fromVoice:t,toVoice:s}=e;if(!this.currentSession)return;let n={fromVoice:t,toVoice:s,timestamp:Date.now()};this.currentSession.voiceChanges.push(n),this.currentSession.voiceId=s,(0,d.$s)("voice_voice_changed",void 0,{sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",fromVoice:t,toVoice:s,changeCount:this.currentSession.voiceChanges.length.toString()})}trackScreenShareStart(){this.currentSession&&(this.currentSession.screenShareStartTime=Date.now(),(0,d.$s)("voice_screen_share_started",void 0,{sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable"}))}trackScreenShareEnd(){if(!this.currentSession||!this.currentSession.screenShareStartTime)return;let e=Date.now()-this.currentSession.screenShareStartTime;this.currentSession.screenShareDuration=(this.currentSession.screenShareDuration||0)+e,this.currentSession.screenShareStartTime=void 0,(0,d.$s)("voice_screen_share_ended",e,{sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",duration:e.toString(),totalScreenShareDuration:this.currentSession.screenShareDuration.toString()})}trackError(e,t){if(!this.currentSession)return;let s={type:e,message:t,timestamp:Date.now()};this.currentSession.errors.push(s),(0,d.$s)("voice_session_error",void 0,{sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",errorType:e,errorMessage:t,errorCount:this.currentSession.errors.length.toString()})}endVoiceSession(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"user_initiated";if(!this.currentSession)return;let t=Date.now();this.currentSession.endTime=t,this.currentSession.endReason=e,this.currentSession.readyTime&&(this.currentSession.totalDuration=t-this.currentSession.readyTime),this.currentSession.screenShareStartTime&&this.trackScreenShareEnd(),(0,d.$s)("voice_session_ended",this.currentSession.sessionId,{sessionId:this.currentSession.sessionId,requestId:this.currentSession.requestId||"unavailable",endReason:e,totalDuration:(this.currentSession.totalDuration||0).toString(),connectionDuration:(this.currentSession.connectionDuration||0).toString(),userTurns:this.currentSession.userTurns.toString(),assistantTurns:this.currentSession.assistantTurns.toString(),totalTurns:(this.currentSession.userTurns+this.currentSession.assistantTurns).toString(),screenShareDuration:(this.currentSession.screenShareDuration||0).toString(),personalityChanges:this.currentSession.personalityChanges.length.toString(),errors:this.currentSession.errors.length.toString(),manualMessages:this.currentSession.manualMessagesSent.toString(),voiceId:this.currentSession.voiceId,personalityId:this.currentSession.personalityId||"none",customInstructions:this.currentSession.customInstructions||"none",enableSearch:this.currentSession.enableSearch.toString(),enableVision:this.currentSession.enableVision.toString()}),this.currentSession=null}trackConnectionStateChange(e,t){this.currentSession&&"disconnected"===t&&"disconnecting"!==e&&this.trackError("unexpected_disconnection","Connection changed from ".concat(e," to ").concat(t))}constructor(){this.currentSession=null}}c.instance=null;let u=c.getInstance();var h=s(65258),m=s(88223),p=s(49972),g=s(36936),v=s(29938),f=s(43893),I=s(44347),y=s(13511),S=s(83318),w=s(38541),b=s.n(w),C=s(12110),x=s(14908),R=s(27853),_=s(6132),k=s(4890),T=s(17823),M=s(79342);let P=[1];var E=s(98100),B=s(17014),N=s(88382),A=s(65146);let z=e=>{let{modelName:t,reasoningMode:s,waitTimeSeconds:n}=e,{t:o}=(0,A.Bd)("chat"),{modelById:i}=(0,E.GB)(),r=(0,N.useMemo)(()=>{var e;return(null==(e=i[t])?void 0:e.name)||t},[i,t]),a=(0,N.useMemo)(()=>{let e=Math.floor(n/3600),t=Math.floor(n%3600/60);return e>0&&t>0?"".concat(o("time.hours",{defaultValue_one:"{{count}} hour",defaultValue_other:"{{count}} hours",count:e})," ").concat(o("time.minutes",{count:t,defaultValue_one:"{{count}} minutes",defaultValue_other:"{{count}} minutes"})):e>0?o("time.hours",{defaultValue_one:"{{count}} hour",defaultValue_other:"{{count}} hours",count:e}):o("time.minutes",{count:t,defaultValue_one:"{{count}} minutes",defaultValue_other:"{{count}} minutes"})},[n,o]),l=(0,N.useMemo)(()=>"DEEPSEARCH"===s?o("Rate Limit Reached.description-deepsearch","Query limit reached for {{modelName}} with DeepSearch. Limit refreshes in {{time}}.",{modelName:r,time:a}):"DEEPERSEARCH"===s?o("Rate Limit Reached.description-deepersearch","Query limit reached for {{modelName}} with DeeperSearch. Limit refreshes in {{time}}.",{modelName:r,time:a}):"REASONING"===s?o("Rate Limit Reached.description-reasoning","Query limit reached for {{modelName}} with Think. Limit refreshes in {{time}}.",{modelName:r,time:a}):o("Rate Limit Reached.description","Query limit reached for {{modelName}}. Limit refreshes in {{time}}.",{modelName:r,time:a}),[a,r,o,s]);return(0,M.jsxs)("div",{className:"flex items-center gap-2",children:[(0,M.jsx)(B.id,{className:"size-5"}),(0,M.jsx)("div",{className:"font-semibold text-xs",children:l})]})},V=e=>{let{modelName:t,reasoningMode:s,remainingQueries:n,windowSizeSeconds:o}=e,{t:i}=(0,A.Bd)("chat"),{modelById:r}=(0,E.GB)(),a=(0,N.useMemo)(()=>{var e;return(null==(e=r[t])?void 0:e.name)||t},[r,t]),l=(0,N.useMemo)(()=>{let e=Math.floor(o/3600),t=Math.floor(o%3600/60);return e>0&&t>0?"".concat(i("time.hours",{defaultValue_one:"{{count}} hour",defaultValue_other:"{{count}} hours",count:e})," ").concat(i("time.minutes",{count:t,defaultValue_one:"{{count}} minutes",defaultValue_other:"{{count}} minutes"})):e>0?i("time.hours",{defaultValue_one:"{{count}} hour",defaultValue_other:"{{count}} hours",count:e}):i("time.minutes",{count:t,defaultValue_one:"{{count}} minutes",defaultValue_other:"{{count}} minutes"})},[o,i]),d=(0,N.useMemo)(()=>"DEEPSEARCH"===s?i("Remaining Queries.description-deepsearch",{modelName:a,count:n,time:l,defaultValue_one:"One query left for {{modelName}} with DeepSearch. Limit resets every {{time}}.",defaultValue_other:"You have {{count}} remaining queries for {{modelName}} with DeepSearch. Limit resets every {{time}}."}):"DEEPERSEARCH"===s?i("Remaining Queries.description-deepersearch",{modelName:a,count:n,time:l,defaultValue_one:"One query left for {{modelName}} with DeeperSearch. Limit resets every {{time}}.",defaultValue_other:"You have {{count}} remaining queries for {{modelName}} with DeeperSearch. Limit resets every {{time}}."}):"REASONING"===s?i("Remaining Queries.description-reasoning",{modelName:a,count:n,time:l,defaultValue_one:"One query left for {{modelName}} with Think. Limit resets every {{time}}.",defaultValue_other:"You have {{count}} remaining queries for {{modelName}} with Think. Limit resets every {{time}}."}):i("Remaining Queries.description",{modelName:a,count:n,time:l,defaultValue_one:"One query left for {{modelName}}. Limit resets every {{time}}.",defaultValue_other:"You have {{count}} remaining queries for {{modelName}}. Limit resets every {{time}}."}),[n,a,l,i,s]);return(0,M.jsxs)("div",{className:"flex items-center gap-2",children:[(0,M.jsx)(B.id,{className:"size-5"}),(0,M.jsx)("div",{className:"text-xs font-semibold",children:d})]})};function L(e){m.tW.rateLimitsGetRateLimits({body:e}).then(t=>{void 0!==t.remainingQueries&&P.includes(t.remainingQueries)?x.oR.info((0,M.jsx)(V,{reasoningMode:e.requestKind,modelName:e.modelName,remainingQueries:t.remainingQueries,windowSizeSeconds:t.windowSizeSeconds||0}),{duration:7e3}):0===t.remainingQueries&&t.waitTimeSeconds&&x.oR.info((0,M.jsx)(z,{reasoningMode:e.requestKind,modelName:e.modelName,waitTimeSeconds:t.waitTimeSeconds}),{duration:7e3})}).catch(e=>{(0,a.vV)("chat-page-store:checkRateLimits",e)})}function U(e,t){let s=function(e,t){let s=e.trim().replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,"");return s.length>200?s.slice(0,200)+"...":s}(e,200);x.oR.info(s,{duration:7e3}),(0,d.$s)("show_disclaimer",s,{conversationId:t})}_.z.union([_.z.literal("auto"),_.z.literal("image"),_.z.literal("search"),_.z.literal("modelOnly"),_.z.literal("noSearch")]),_.z.union([_.z.literal("chat"),_.z.literal("voice")]);class j{constructor(e,t){this.set=e,this.get=t,this.activeModelId=o.Sk,this.isRateLimited=!1,this.isThinkingRateLimited=!1,this.isDeepSearchRateLimited=!1,this.isUnauthenticated=!1,this.hasDismissedDisclaimer=!1,this.conversationMode="chat",this.outputMode="auto",this.reasoningMode="none",this.usingExperiment=!1,this.experiments=[],this.streamingExperimentsIds=[],this.queryBarExpanded=!1,this.isTypingDebounce=!1,this.metadata={},this.selectedPersonalityId=void 0,this.customPersonality=void 0,this.queryByConversationId={},this.chatPageLoaded=!1,this.isDeeperSearchSelected=!1,this.livekitRoom=null,this.livekitToken=null,this.livekitRequestId=null,this.voiceConnectionStatus="disconnected",this.voiceId="Ara",this.voicePersonalityId=null,this.voiceCustomInstructions=null,this.voiceEnableSearch=!0,this.voiceModeTimeoutId=null,this.currentVoiceSessionId=null,this.setConversationId=(0,h.kp)(this.set,"conversationId"),this.setOptimisticConversationId=(0,h.kp)(this.set,"optimisticConversationId"),this.setLastMessageId=(0,h.kp)(this.set,"lastMessageId"),this.setSidePanelContent=(0,h.kp)(this.set,"sidePanelContent"),this.toggleSidePanelContent=e=>{let t=this.get().sidePanelContent;(null==t?void 0:t.type)===e.type&&t.data===e.data?this.setSidePanelContent(void 0):this.setSidePanelContent(e)},this.setStreamedMessageId=(0,h.kp)(this.set,"streamedMessageId"),this.setActiveModelId=(0,h.kp)(this.set,"activeModelId"),this.setSelectedSystemPromptId=(0,h.kp)(this.set,"selectedSystemPromptId"),this.setIsRateLimited=(0,h.kp)(this.set,"isRateLimited"),this.setIsUnauthenticated=(0,h.kp)(this.set,"isUnauthenticated"),this.setHasDismissedDisclaimer=(0,h.kp)(this.set,"hasDismissedDisclaimer"),this.setOptimisticMessageId=(0,h.kp)(this.set,"optimisticMessageId"),this.setConversationMode=(0,h.kp)(this.set,"conversationMode"),this.setOutputMode=(0,h.kp)(this.set,"outputMode"),this.setReasoningMode=(0,h.kp)(this.set,"reasoningMode"),this.setChatPageLoaded=(0,h.kp)(this.set,"chatPageLoaded"),this.setDefaultAnonModelId=(0,h.kp)(this.set,"defaultAnonModelId"),this.setDefaultFreeModelId=(0,h.kp)(this.set,"defaultFreeModelId"),this.setDefaultProModelId=(0,h.kp)(this.set,"defaultProModelId"),this.setMetadata=(0,h.kp)(this.set,"metadata"),this.setUsingExperiment=e=>{this.removeAllExperiments(),this.removeAllStreamingExperiments(),this.set(t=>({...t,usingExperiment:e}))},this.removeAllExperiments=(0,h.dX)(this.set,"experiments",[]),this.setExperiments=(0,h.kp)(this.set,"experiments"),this.addExperiment=(0,h.WQ)(this.set,"experiments"),this.removeExperiment=e=>{this.set(t=>{let s=[...t.experiments];return s.splice(e,1),{...t,experiments:s}})},this.setStreamingExperimentsIds=(0,h.kp)(this.set,"streamingExperimentsIds"),this.addStreamingExperimentId=(0,h.WQ)(this.set,"streamingExperimentsIds"),this.removeAllStreamingExperiments=(0,h.dX)(this.set,"streamingExperimentsIds",[]),this.setSelectedPersonalityId=(0,h.kp)(this.set,"selectedPersonalityId"),this.setCustomPersonality=(0,h.kp)(this.set,"customPersonality"),this.idsetQueryByConversationId=(0,h.q5)(this.set,"queryByConversationId"),this.setQueryBarExpanded=e=>this.set({queryBarExpanded:e}),this.setIsTypingDebounce=e=>this.set({isTypingDebounce:e}),this.setIsDeeperSearchSelected=(0,h.kp)(this.set,"isDeeperSearchSelected"),this.setLivekitRoom=(0,h.kp)(this.set,"livekitRoom"),this.setLivekitToken=(0,h.kp)(this.set,"livekitToken"),this.setLivekitRequestId=(0,h.kp)(this.set,"livekitRequestId"),this.setVoiceConnectionStatus=e=>{let t=this.get().voiceConnectionStatus;this.set({voiceConnectionStatus:e}),this.get().currentVoiceSessionId&&t!==e&&(u.trackConnectionStateChange(t,e),"ready"===e&&u.trackConnectionReady())},this.setVoiceId=(0,h.kp)(this.set,"voiceId"),this.setVoicePersonalityId=(0,h.kp)(this.set,"voicePersonalityId"),this.setVoiceCustomInstructions=(0,h.kp)(this.set,"voiceCustomInstructions"),this.setVoiceEnableSearch=(0,h.kp)(this.set,"voiceEnableSearch"),this.setVoiceModeTimeoutId=(0,h.kp)(this.set,"voiceModeTimeoutId"),this.setCurrentVoiceSessionId=(0,h.kp)(this.set,"currentVoiceSessionId"),this.isErrorRetryable=e=>{let t=(0,l.G1)(e);return 429===t?(this.setIsRateLimited(!0),!1):401===t?(this.setIsUnauthenticated(!0),!1):!(t&&t>=400&&t<500||e.message.includes("Failed to respond")||e.message.includes(y.CZ)||e.message.includes(y.S3))},this.establishNewConversation=async e=>{let{temporary:t,message:s,fileAttachmentIds:n,webpageUrls:a,toolOverrides:l,isPreset:d,persona:c,enableRetries:u,disableArtifactDiff:h,imageEditUri:m,workspaceIds:p,responseMetadata:g,isFromGrokFiles:y,disableToolComposer:S=!1,disableMemory:w=!1,ff:C}=e,x=this.get(),R=f.A3.getState(),_=I.C$.getState(),k=v.jN.getState(),T=b().get(k.byId,_.userSettings.preferences.selectedSystemPromptId||""),M=x.activeModelId,P=q(void 0,x.reasoningMode,M),E=void 0,B=(null==T?void 0:T.prompt)||x.customPersonality,N=c&&M!==o.E8?"".concat(B,"\n\n").concat(c.prompt,"."):B,A=!1,z={...x.metadata,...g};return x.setMetadata({}),new Promise((e,o)=>{R.streamCreateAndRespond({temporary:t,message:s,modelName:M,fileAttachmentIds:n,webpageUrls:a,systemPromptName:null==c?void 0:c.systemPromptName,personaId:null==c?void 0:c.personaId,toolOverrides:null!=l?l:O(x.outputMode,P),isPreset:d,customInstructions:E,customPersonality:N,deepsearchPreset:(0,i.Ku)(P),isReasoning:"think"===P,imageEditUri:m,enableRetries:u,disableArtifactDiff:h,workspaceIds:p,responseMetadata:z,isFromGrokFiles:y,disableToolComposer:S,disableMemory:w,onOptimisticConversation:e=>{let{conversationId:t}=e;x.setOptimisticConversationId(t)},onOptimisticResponse:e=>{let{responseId:t}=e;x.setOptimisticMessageId(t)},onStart:e=>{var t;x.setStreamedMessageId(null==(t=e[0])?void 0:t.responseId)},onConversation:t=>{x.setConversationId(t.conversationId),x.setOptimisticConversationId(void 0),A=!0,e(t)},onUserResponse:e=>{x.setLastMessageId(e.responseId),x.setOptimisticMessageId(e.responseId)},onStartExperiment:e=>{x.setUsingExperiment(!0),e.forEach(e=>{x.addStreamingExperimentId(e),x.addExperiment({})})},onCitations:()=>{},onDisclaimer:c?()=>{}:U,onHasImage:(0,r.S)(()=>_.setShowAgeVerification(!0)),onClose:e=>{e.length>1&&(x.setExperiments(e),x.setStreamingExperimentsIds(e.map(e=>e.responseId)));let t=b().first(e);t&&this.get().lastMessageId===t.parentResponseId&&(x.setLastMessageId(t.responseId),x.setStreamedMessageId(t.responseId)),L({modelName:M,requestKind:(0,i.ot)(P)}),A?x.setOptimisticConversationId(void 0):o(Error("Not resolved by close"))},onWke:e=>{"RateLimitError"===e.name&&x.setIsRateLimited(!0),o(e)},onError:this.isErrorRetryable,ff:C}).catch(e=>{o(e)})})},this.sendResponse=async e=>{var t;let{message:s,parentResponseId:n,parentQuotedText:a,conversationId:l,fileAttachmentIds:d,webpageUrls:c,toolOverrides:u,setOpimisticUserResponse:h,setUserResponse:m,onOptimisticUserResponse:p,onError:g,imageEditUri:y,persona:S,enableRetries:w,disableArtifactDiff:C,metadata:x,followUpType:R,reasoningMode:_,isFromGrokFiles:k,resumeResponseId:T,disableToolComposer:M=!1,disableMemory:P=!1,modelIdOverride:E,ff:B}=e,N=this.get(),A=f.A3.getState(),z=I.C$.getState(),V=v.jN.getState(),j=b().get(V.byId,z.userSettings.preferences.selectedSystemPromptId||""),D=null!=E?E:N.activeModelId,F=void 0,G=null!=(t=(null==j?void 0:j.prompt)||N.customPersonality)?t:"",Q=S&&D!==o.E8?"".concat(G,"\n\n").concat(S.prompt,"."):G;N.setUsingExperiment(!1),N.setLastMessageId(n);let $=q(_,N.reasoningMode,D),W={...N.metadata,...x};return N.setMetadata({}),new Promise((e,t)=>{A.streamResponse({message:s,metadata:W,parentResponseId:n,parentQuotedText:a,conversationId:l,modelName:D,systemPromptName:null==S?void 0:S.systemPromptName,fileAttachmentIds:d,webpageUrls:c,toolOverrides:{...O(N.outputMode,$),...null!=u?u:{}},customInstructions:F,customPersonality:Q,deepsearchPreset:(0,i.Ku)($),isReasoning:"think"===$,imageEditUri:y,enableRetries:w,disableArtifactDiff:C,followUpType:R,isFromGrokFiles:k,resumeResponseId:T,disableToolComposer:M,disableMemory:P,onOptimisticUserResponse:e=>{h&&(N.setOptimisticMessageId(e.responseId),null==p||p(e))},onOptimisticModelResponse:e=>{N.setStreamedMessageId(e.responseId)},onStart:e=>{var t;N.setStreamedMessageId(null==(t=e[0])?void 0:t.responseId)},onUserResponse:e=>{m&&(N.setLastMessageId(e.responseId),N.setOptimisticMessageId(e.responseId))},onStartExperiment:e=>{N.setUsingExperiment(!0),e.forEach(e=>{N.addStreamingExperimentId(e),N.addExperiment({})})},onCitations:()=>{},onDisclaimer:S?()=>{}:U,onHasImage:(0,r.S)(()=>z.setShowAgeVerification(!0)),onClose:s=>{s.length>1&&(N.setExperiments(s),N.setStreamingExperimentsIds(s.map(e=>e.responseId)));let n=b().first(s);if(n&&this.get().lastMessageId===n.parentResponseId&&(N.setLastMessageId(n.responseId),N.setStreamedMessageId(n.responseId)),s.length&&s.every(e=>"closed"===e.state))e(s);else{let e=Error("Responses missing, errored, or not closed");null==g||g(e),t(e)}L({modelName:D,requestKind:(0,i.ot)($)})},onWke:e=>{"RateLimitError"===e.name&&N.setIsRateLimited(!0),null==g||g(e),t(e)},onError:this.isErrorRetryable,ff:B}).catch(e=>{null==g||g(e),t(e)})})},this.reconnectToInflightResponses=async(e,t)=>{let s=this.get(),n=f.A3.getState(),o=I.C$.getState(),l=s.activeModelId;try{let d=await n.fetchListInflightResponses(e);if(!d.length)return;let c=b().maxBy(d,e=>new Date(e.createTime?e.createTime:0));if(!c)return;if(!c.responseId)return void(0,a.vV)("chat-page-store:reconnectToInflightResponses","Inflight response missing response id");if(!c.parentResponseId)return void(0,a.vV)("chat-page-store:reconnectToInflightResponses","Inflight response missing parent response id:");s.setLastMessageId(c.parentResponseId),await n.reconnectToResponse({inflightResponse:c,conversationId:e,modelName:l,parentResponseId:c.parentResponseId,enableRetries:t,isReasoning:"think"===s.reasoningMode,deepsearchPreset:(0,i.Ku)(s.reasoningMode),onStart:e=>{let t=e[0];t&&s.setStreamedMessageId(t.responseId)},onCitations:()=>{},onDisclaimer:U,onHasImage:(0,r.S)(()=>o.setShowAgeVerification(!0)),onClose:(e,t)=>{e.length>1&&(s.setExperiments(e),s.setStreamingExperimentsIds(t));let n=b().first(e);n&&(s.setLastMessageId(n.responseId),s.setStreamedMessageId(void 0)),L({modelName:l,requestKind:(0,i.ot)(s.reasoningMode)})},onWke:e=>{"RateLimitError"===e.name&&s.setIsRateLimited(!0),(0,a.vV)("chat-page-store:reconnectToInflightResponses","Error reconnecting to inflight response")},onError:this.isErrorRetryable})}catch(e){(0,a.vV)("chat-page-store:reconnectToInflightResponses","Error checking inflight responses")}},this.requestLivekitToken=async(e,t)=>{let s=this.get(),o=null===n.sessionStoreState||void 0===n.sessionStoreState?void 0:n.sessionStoreState.getState();try{var i,r,l;let n=await m.hx.livekitCreateToken({body:{conversationId:t,sessionPayload:JSON.stringify({voice:s.voiceId,personality:s.voicePersonalityId,instructions:F({username:null==o||null==(i=o.user)?void 0:i.givenName,customInstructions:s.voiceCustomInstructions||void 0}),enable_search:s.voiceEnableSearch,enable_vision:(null==(l=s.livekitRoom)||null==(r=l.localParticipant)?void 0:r.isScreenShareEnabled)||!1,turn_detection:{type:"server_vad"}}),requestAgentDispatch:!1,livekitUrl:e}});if(!n.token)throw Error("No livekit token returned");return s.setLivekitToken(n.token),s.setLivekitRequestId(n.requestId||null),{token:n.token,requestId:n.requestId||null}}catch(e){throw(0,a.vV)("chat-page-store:requestLivekitToken","Failed to get livekit token"),e}},this.enterVoiceMode=async e=>{var t,s,n,o;let i=this.get();if(this.voiceModeTimeoutId&&(clearTimeout(this.voiceModeTimeoutId),this.setVoiceModeTimeoutId(null)),"voice"===i.conversationMode&&"disconnected"!==i.voiceConnectionStatus)throw(0,a.vV)("chat-page-store:enterVoiceMode","Already in voice mode"),Error("Already in voice mode");let r=(0,R.A)();this.setCurrentVoiceSessionId(r),u.startVoiceSession({sessionId:r,voiceId:i.voiceId,personalityId:i.voicePersonalityId,customInstructions:i.voiceCustomInstructions,enableSearch:i.voiceEnableSearch,enableVision:!!(null==(s=i.livekitRoom)||null==(t=s.localParticipant)?void 0:t.isScreenShareEnabled)}),this.setConversationMode("voice"),this.setVoiceConnectionStatus("connecting"),(0,S.He)("silent");try{let{token:t,requestId:s}=await this.requestLivekitToken(e,i.conversationId);u.setRequestId(s);let n=new S.Wv({publishDefaults:{screenShareEncoding:{maxBitrate:35e5,maxFramerate:1}}});this.setLivekitRoom(n),n.prepareConnection(e,t).catch(()=>{(0,a.vV)("chat-page-store:enterVoiceMode","Failed to prepare connection"),u.trackError("connection_prepare_failed","Failed to prepare connection")});let o=null,r=new Promise(e=>{o=e});n.on(S.u9.Disconnected,async()=>{await this.exitVoiceMode("connection_lost")}),n.on(S.u9.Reconnecting,()=>{this.setVoiceConnectionStatus("reconnecting")}),n.on(S.u9.Reconnected,()=>{this.setVoiceConnectionStatus("connected")}),n.on(S.u9.ParticipantDisconnected,async()=>(u.trackError("participant_disconnected","Participant disconnected"),this.exitVoiceMode("participant_disconnected").finally(()=>{x.oR.error("Voice connection lost")}))),n.on(S.u9.DataReceived,(e,t,s,n)=>{let i=new TextDecoder().decode(e);if("realtime_server_events"===n){let e=JSON.parse(i);switch(e.type){case"ping":return this.handleVoiceConnectionPing();case"conversation.created":var r;if(u.trackConversationCreated({conversationId:null==e||null==(r=e.conversation)?void 0:r.id,connectionState:this.get().voiceConnectionStatus}),["connecting","reconnecting","connected"].includes(this.get().voiceConnectionStatus))return this.setVoiceConnectionStatus("ready"),o&&o(),this.handleConversationCreated(e);break;case"conversation.item.created":return this.handleConversationItemCreated(e);case"response.created":return this.handleAssistantVoiceResponseCreated(e);case"response.audio_transcript.delta":return this.handleAssistantVoiceResponseTranscriptDelta(e);case"response.search.result":return this.handleVoiceResponseSearchResult(e);case"response.grok.output":return this.handleVoiceGrokOutput(e)}}}),await n.connect(e,t).then(()=>this.setVoiceConnectionStatus("connected")),await n.localParticipant.setMicrophoneEnabled(!0,{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}).catch(()=>{let e="Failed to set microphone enabled";throw(0,a.vV)("chat-page-store:enterVoiceMode",e),u.trackError("microphone_enable_failed",e),Error(e)});let l=new Promise((e,t)=>{this.setVoiceModeTimeoutId(setTimeout(()=>{(0,a.vV)("chat-page-store:enterVoiceMode","Connection ready timeout after 10 seconds"),t(Error("Voice connection ready timeout after 10 seconds"))},1e4))});try{await Promise.race([r,l]),this.get().voiceModeTimeoutId&&(clearTimeout(this.get().voiceModeTimeoutId),this.setVoiceModeTimeoutId(null))}catch(e){throw this.get().voiceModeTimeoutId&&(clearTimeout(this.get().voiceModeTimeoutId),this.setVoiceModeTimeoutId(null)),u.trackError("enter_voice_mode_timeout","Connection ready timeout after 10 seconds"),await this.exitVoiceMode("connection_timeout"),e}}catch(t){(0,a.vV)("chat-page-store:enterVoiceMode","Failed to enter voice mode");let e=t.message||"Unknown error";if(u.trackError("enter_voice_mode_failed",e),await this.exitVoiceMode("connection_error"),(null==(n=t.message)?void 0:n.includes("Permission denied"))||(null==(o=t.message)?void 0:o.includes("NotAllowedError")))throw Error("mic-permission-denied");throw t}},this.exitVoiceMode=async e=>{let t=this.get(),s=p.w.getState();if("disconnecting"!==t.voiceConnectionStatus&&"disconnected"!==t.voiceConnectionStatus){if(t.setVoiceConnectionStatus("disconnecting"),t.currentVoiceSessionId&&(u.endVoiceSession(e),this.setCurrentVoiceSessionId(null)),t.voiceModeTimeoutId&&(clearTimeout(t.voiceModeTimeoutId),this.setVoiceModeTimeoutId(null)),t.streamedMessageId){let e=f.A3.getState(),s=e.byId[t.streamedMessageId],n=s.responseId,o=s.inflightResponseId||(0,R.A)();e.upsertResponse({...s,state:"closed",partial:!0,responseId:o}),this.setStreamedMessageId(void 0),this.setOptimisticMessageId(void 0),this.setLastMessageId(o),e.removeResponse(n)}if(t.livekitRoom){try{var n;await (null==(n=t.livekitRoom.localParticipant)?void 0:n.publishData(new TextEncoder().encode(""),{topic:"disconnect"}))}catch(e){(0,a.vV)("chat-page-store:exitVoiceMode","Failed to publish disconnect data"),u.trackError("disconnect_data_publish_failed","Failed to publish disconnect data")}await t.livekitRoom.disconnect()}t.optimisticConversationId&&(s.removeConversation(t.optimisticConversationId),this.setOptimisticConversationId(void 0),s.removeAbortControllerById(t.optimisticConversationId)),this.setLivekitRoom(null),this.setLivekitToken(null),this.setLivekitRequestId(null),this.setVoiceConnectionStatus("disconnected"),this.setConversationMode("chat")}},this.toggleScreenSharing=async()=>{var e;let t=this.get();if(!(null==t?void 0:t.livekitRoom)||!(null==t||null==(e=t.livekitRoom)?void 0:e.localParticipant)||"ready"!==t.voiceConnectionStatus)throw(0,a.vV)("chat-page-store:startScreenShare","Voice connection not ready"),Error("Voice connection not ready");let s=t.livekitRoom.localParticipant.isScreenShareEnabled;try{await t.livekitRoom.localParticipant.setScreenShareEnabled(!s,{audio:!1,video:!0,selfBrowserSurface:"exclude",surfaceSwitching:"include"}).then(()=>(s?u.trackScreenShareEnd():u.trackScreenShareStart(),t.sendVoiceSettingsUpdate({voiceId:t.voiceId,voicePersonalityId:t.voicePersonalityId,voiceCustomInstructions:t.voiceCustomInstructions,voiceEnableSearch:t.voiceEnableSearch})))}catch(e){throw(0,a.vV)("chat-page-store:toggleScreenSharing","Failed to toggle screen share"),u.trackError("screen_share_toggle_failed","Failed to toggle screen share"),e}},this.sendVoiceSettingsUpdate=async e=>{var t,s,o;let{voiceId:i,voicePersonalityId:r,voiceCustomInstructions:l,voiceEnableSearch:d}=e,c=this.get();if(!c.livekitRoom||"ready"!==c.voiceConnectionStatus)throw(0,a.vV)("chat-page-store:sendVoiceSessionUpdate","Voice connection not ready"),Error("Voice connection not ready");let h={voiceId:c.voiceId,voicePersonalityId:c.voicePersonalityId,voiceCustomInstructions:c.voiceCustomInstructions,voiceEnableSearch:c.voiceEnableSearch};(h.voicePersonalityId!==r||h.voiceCustomInstructions!==l)&&u.trackPersonalityChange({fromPersonality:h.voicePersonalityId,toPersonality:r,fromCustomInstructions:h.voiceCustomInstructions,toCustomInstructions:l}),h.voiceId!==i&&u.trackVoiceChange({fromVoice:h.voiceId,toVoice:i}),this.setVoiceId(i),this.setVoicePersonalityId(r),this.setVoiceCustomInstructions(l),this.setVoiceEnableSearch(d);let m=null===n.sessionStoreState||void 0===n.sessionStoreState?void 0:n.sessionStoreState.getState(),p={instructions:F({username:null==m||null==(t=m.user)?void 0:t.givenName,customInstructions:c.voiceCustomInstructions||void 0}),voice:i,personality:r,enable_search:d,enable_vision:(null==(o=c.livekitRoom)||null==(s=o.localParticipant)?void 0:s.isScreenShareEnabled)||!1};return c.livekitRoom.localParticipant.publishData(new TextEncoder().encode(JSON.stringify({type:"session.update",session:p})),{topic:"realtime_client_event"}).catch(()=>{throw(0,a.vV)("chat-page-store:sendVoiceSettingsUpdate","Failed to send voice settings update"),u.trackError("voice_settings_update_failed","Failed to send voice settings update"),this.setVoiceId(h.voiceId),this.setVoicePersonalityId(h.voicePersonalityId),this.setVoiceCustomInstructions(h.voiceCustomInstructions),this.setVoiceEnableSearch(h.voiceEnableSearch),Error("Failed to send voice settings update")})},this.sendVoiceManualMessage=async e=>{let{message:t}=e,s=this.get();if(!s.livekitRoom||"ready"!==s.voiceConnectionStatus)throw(0,a.vV)("chat-page-store:sendVoiceManualMessage","Voice connection not ready"),Error("Voice connection not ready");return u.trackManualMessage(),s.livekitRoom.localParticipant.publishData(new TextEncoder().encode(t),{topic:"grok.chat"}).catch(()=>{throw(0,a.vV)("chat-page-store:sendVoiceManualMessage","Failed to send voice message"),u.trackError("manual_message_failed","Failed to send voice message"),Error("Failed to send voice message")})},this.handleVoiceConnectionPing=()=>{let e=this.get();return e.livekitRoom?e.livekitRoom.localParticipant.publishData(new TextEncoder().encode(JSON.stringify({timestamp:Date.now()})),{topic:"grok.ping"}):void(0,a.vV)("chat-page-store:handleVoiceConnectionPing","No livekit room available")},this.handleConversationCreated=e=>{let{conversation:t}=e,s=this.get(),n=p.w.getState();if(!s.conversationId&&!s.optimisticConversationId){if(!(null==t?void 0:t.id))return(0,a.vV)("chat-page-store:handleConversationCreated","Missing conversation id"),this.exitVoiceMode();let e={...(0,p.b)({conversationId:t.id,temporary:!1}),mediaTypes:["audio"]};n.upsertAndCacheConversation(e),this.setOptimisticConversationId(t.id);let s=new AbortController;n.idsertAbortControllerById(s,t.id)}},this.handleConversationItemCreated=e=>{var t,s,n,o,i,r,l,d;let{item:c}=e;if(!c||!c.id)return void(0,a.vV)("chat-page-store:handleConversationItemCreated","Missing item or item.id");if("user"!==c.role||"completed"!==c.status||!(null==(s=c.content)||null==(t=s[0])?void 0:t.text)&&!(null==(o=c.content)||null==(n=o[0])?void 0:n.transcript))return;u.trackUserTurn();let h=this.get(),m=f.A3.getState(),g=p.w.getState(),v=h.conversationId;if(!h.conversationId&&h.optimisticConversationId){let e={...g.byId[h.optimisticConversationId],state:"closed"};v=e.conversationId,g.upsertAndCacheConversation(e),h.set({optimisticConversationId:void 0,conversationId:e.conversationId}),m.idsertNodesByConversationId([],e.conversationId)}else if(!h.conversationId||!h.lastMessageId)return void(0,a.vV)("chat-page-store:handleConversationItemCreated","Missing conversationId or lastMessageId");let I=m.byId[c.id];if(I)return void m.upsertResponse({...I,message:(null==(l=c.content)?void 0:l[0].text)||(null==(d=c.content)?void 0:d[0].transcript)||""});let y=h.lastMessageId;if(h.streamedMessageId){let e=f.A3.getState(),t=e.byId[h.streamedMessageId],s=t.responseId,n=t.inflightResponseId||(0,R.A)();y=n,e.upsertResponse({...t,state:"closed",partial:!0,responseId:n,inflightResponseId:void 0}),this.setStreamedMessageId(void 0),this.setOptimisticMessageId(void 0),this.setLastMessageId(n),e.removeResponse(s)}m.createVoiceUserMessage({userResponseId:c.id,conversationId:v,parentResponseId:y,message:(null==(i=c.content)?void 0:i[0].text)||(null==(r=c.content)?void 0:r[0].transcript)||"",onUserResponse:e=>{h.setLastMessageId(e.responseId)},onOptimisticModelResponse:e=>{h.setStreamedMessageId(e.responseId)}})},this.handleAssistantVoiceResponseCreated=e=>{let{response:t}=e;if(!(null==t?void 0:t.id))return void(0,a.vV)("chat-page-store:handleAssistantVoiceResponseCreated","Missing response id");let s=this.get(),n=f.A3.getState();if(!s.streamedMessageId)return;let o=n.byId[s.streamedMessageId];return o&&(null==o?void 0:o.parentResponseId)?n.byId[o.parentResponseId]?void(o.inflightResponseId?n.upsertResponse({...o,message:"",inflightResponseId:t.id,state:"streaming"}):(n.upsertResponse({...o,inflightResponseId:t.id,state:"streaming"}),s.setStreamedMessageId(o.responseId))):void(0,a.vV)("chat-page-store:handleAssistantVoiceResponseCreated","Missing parent response"):void(0,a.vV)("chat-page-store:handleAssistantVoiceResponseCreated","Missing streaming response or parent response id")},this.handleAssistantVoiceResponseTranscriptDelta=e=>{let{response_id:t,delta:s}=e;if(!t||!s)return void(0,a.vV)("chat-page-store:handleAssistantVoiceResponseTranscriptDelta","Missing response_id or delta");let n=f.A3.getState(),o=this.get();if(!o.conversationId)return void(0,a.vV)("chat-page-store:handleAssistantVoiceResponseTranscriptDelta","Missing conversationId");let i=n.byConversationId[o.conversationId].find(e=>e.inflightResponseId===t);i&&"streaming"===i.state&&n.upsertResponse({...i,message:i.message+s})},this.handleVoiceGrokOutput=e=>{let{response_id:t,follow_ups:s}=e;if(!t)return void(0,a.vV)("chat-page-store:handleVoiceGrokOutput","Missing response_id");let n=f.A3.getState(),o=this.get();if(!o.conversationId)return void(0,a.vV)("chat-page-store:handleVoiceGrokOutput","Missing conversationId");let i=n.byConversationId[o.conversationId].find(e=>e.inflightResponseId===t);i&&(u.trackAssistantTurn(),n.upsertResponse({...i,state:"closed",partial:!1,responseId:t,suggestions:s,inflightResponseId:void 0}),this.setStreamedMessageId(void 0),this.setOptimisticMessageId(void 0),this.setLastMessageId(t),n.removeResponse(i.responseId))},this.handleVoiceResponseSearchResult=e=>{let{response_id:t,x_posts:s,web_search_results:n}=e;if(!t)return void(0,a.vV)("chat-page-store:handleVoiceResponseSearchResult","Missing response_id");if(!(null==s?void 0:s.length)&&!(null==n?void 0:n.length))return;let o=this.get(),i=f.A3.getState();if(!o.conversationId)return void(0,a.vV)("chat-page-store:handleVoiceResponseSearchResult","Missing conversationId");let r=i.byConversationId[o.conversationId],l=i.byId[t]||r.find(e=>e.inflightResponseId===t);if(!l)return void(0,a.vV)("chat-page-store:handleVoiceResponseSearchResult","Missing response");let d=(null==s?void 0:s.map(e=>({username:e.userhandle,name:e.name,text:e.text,createTime:e.create_time,profileImageUrl:e.profile_image_url,postId:e.post_id,viewCount:e.view_count,citationId:e.post_id})))||[],c=(null==n?void 0:n.map(e=>({url:e.url,title:e.title,preview:e.snippet})))||[];i.upsertResponse({...l,xposts:(null==d?void 0:d.length)?d:l.xposts,xpostIds:(null==d?void 0:d.length)?b().compact(null==d?void 0:d.map(e=>e.postId)):l.xpostIds,webSearchResults:(null==c?void 0:c.length)?c:l.webSearchResults}),d.length?o.setSidePanelContent({type:"xPosts",data:d}):c.length&&o.setSidePanelContent({type:"webSearchResults",data:{webSearchResults:c}})}}}let D=(0,k.v)()((0,T.eh)((0,T.Zr)((e,t)=>new j(e,t),{name:"chat-preferences",partialize:e=>({outputMode:e.outputMode,activeModelId:e.activeModelId,selectedPersonalityId:e.selectedPersonalityId,customPersonality:e.customPersonality,defaultAnonModelId:e.defaultAnonModelId,defaultFreeModelId:e.defaultFreeModelId,defaultProModelId:e.defaultProModelId,voiceId:e.voiceId,voicePersonalityId:e.voicePersonalityId,voiceCustomInstructions:e.voiceCustomInstructions,voiceEnableSearch:e.voiceEnableSearch}),version:1})));function O(e,t){switch(t){case"deepsearch":case"deepersearch":return{imageGen:void 0,webSearch:void 0,xSearch:void 0,xMediaSearch:void 0,trendsSearch:void 0,xPostAnalyze:void 0}}switch(e){case"modelOnly":return{imageGen:!1,webSearch:!1,xSearch:!1,xMediaSearch:!1,trendsSearch:!1,xPostAnalyze:!1};case"noSearch":return{imageGen:void 0,webSearch:!1,xSearch:!1,xMediaSearch:!1,trendsSearch:!1,xPostAnalyze:!1};default:return{imageGen:void 0,webSearch:void 0,xSearch:void 0,xMediaSearch:void 0,trendsSearch:void 0,xPostAnalyze:void 0}}}function F(e){let{username:t,customInstructions:s}=e;return"Reminder: You do not need to introduce yourself unless the user asks for your name. You are Grok, a smart and helpful AI assistant created by xAI. You have a PLEASANT female voice. You're a helpful AI assistant that helps get things done. Never use commands and write your answer as if it was a transcript of an audio conversation. You are using your voice to speak aloud, so keep your responses brief.\n  ".concat(t?"You are speaking with ".concat(t,". Do not repeat the name unless necessary."):"","\n  ").concat(s)}function q(e,t,s){var n,o;if(e)return e;let i=g.V.getState().modelById[s];return((null==i||null==(n=i.tags)?void 0:n.includes("think"))||"think"!==t)&&((null==i||null==(o=i.tags)?void 0:o.includes("deepsearch"))||"deepsearch"!==t&&"deepersearch"!==t)?t:"none"}(0,h.lB)(D,"conversationId","optimisticConversationId",()=>void 0),(0,h.lB)(D,"conversationId","isRateLimited",()=>!1),(0,h.lB)(D,"conversationId","isUnauthenticated",()=>!1),(0,h.lB)(D,"conversationId","hasDismissedDisclaimer",()=>!1),(0,h.lB)(D,"conversationId","usingExperiment",()=>!1),(0,h.lB)(D,"conversationId","experiments",()=>[]),(0,h.lB)(D,"conversationId","streamingExperimentsIds",()=>[]),(0,h.lB)(D,"activeModelId","isRateLimited",()=>!1),(0,h.lB)(D,"reasoningMode","isRateLimited",()=>!1),D.subscribe(e=>e,(e,t)=>{"voice"===e.conversationMode&&(e.conversationId!==t.conversationId&&e.conversationId!==t.optimisticConversationId&&e.conversationId!==e.optimisticConversationId||!e.conversationId&&t.conversationId)&&D.getState().exitVoiceMode("navigation").catch(e=>{(0,a.vV)("chat-page-store:conversationId","Failed to exit voice mode",e)})}),!function(e){let t=new C.w("/chat/:chatId").test(window.location.pathname);e.setState({conversationId:t?t.chatId:void 0})}(D)},41320:(e,t,s)=>{s.d(t,{Di:()=>o,Iu:()=>i});var n=s(88382);function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:768,[t,s]=n.useState(void 0);return n.useEffect(()=>{let t=window.matchMedia("(max-width: ".concat(e-1,"px)")),n=()=>{s(window.innerWidth<e)};return t.addEventListener("change",n),s(window.innerWidth<e),()=>t.removeEventListener("change",n)},[e]),!!t}function i(){let e=o();return{isMobileSize:function(){return e},isTouchDevice:function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}}}},41739:(e,t,s)=>{s.d(t,{a:()=>d});var n=s(65258),o=s(38541),i=s.n(o),r=s(4890),a=s(17823);class l{constructor(e,t){var s=this;this.set=e,this.get=t,this.drawerOpen=!1,this.menuFixed=!0,this.menuHidden=!0,this.tabByConversationId={},this.inEditId=void 0,this.upsertConversationAsTab=function(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],o=s.get(),r=t?o.tabByConversationId[t]:void 0;r&&t&&o.removeTab(t);let a=r||o.tabByConversationId[e.conversationId];if(a)return void o.upsertTab({isTemporary:e.temporary,title:e.title,index:a.index,conversationId:e.conversationId,isPreserved:a.isPreserved});o.setTabByConversationId({...i().mapValues(o.tabByConversationId,e=>({...e,index:e.index+1})),[e.conversationId]:{isTemporary:e.temporary,title:e.title,index:0,conversationId:e.conversationId,isPreserved:n}})},this.upsertTab=(0,n.el)(this.set,"tabByConversationId","conversationId"),this.removeTab=(0,n.TF)(this.set,"tabByConversationId"),this.appendTabByConversationId=(0,n.BC)(this.set,"tabByConversationId","conversationId"),this.setTabByConversationId=(0,n.kp)(this.set,"tabByConversationId"),this.setDrawerOpen=(0,n.kp)(this.set,"drawerOpen"),this.toggleMenuFixed=(0,n.L$)(this.set,"menuFixed"),this.setMenuFixed=(0,n.kp)(this.set,"menuFixed"),this.setMenuHidden=(0,n.kp)(this.set,"menuHidden"),this.setInEditId=(0,n.kp)(this.set,"inEditId")}}let d=(0,r.v)()((0,a.eh)((0,a.Zr)((e,t)=>new l(e,t),{name:"active-chat-tabs",storage:(0,a.KU)(()=>localStorage),partialize:e=>({tabByConversationId:i().omitBy(e.tabByConversationId,e=>!e.isTemporary&&e.isPreserved)}),version:2})))},43893:(e,t,s)=>{s.d(t,{Jg:()=>B,Pn:()=>U,Ko:()=>V,dr:()=>E,A3:()=>P});var n=s(4295),o=s(98100),i=s(44845),r=s(48992),a=s(17703),l=s(33960),d=s(35021),c=s(65258),u=s(88223),h=s(5129);async function*m(e){if(null===e.body)throw Error("Cannot process response chunks of a response without body.");let t=e.body.getReader(),s=new TextDecoder,n="";for(;;){let{done:e,value:o}=await t.read();if(e)break;let[i,r]=p(n+=s.decode(o,{stream:!0}));for(let e of i)yield e;n=r}let[o,i]=p(n);for(let e of o)yield e;i.length>0&&(yield i)}function p(e){let t=e.split("\n"),s=t.pop();return[t,s]}async function*g(e){for await(let t of m(e))try{let s=JSON.parse(t);(0,h.YM)(s,e),yield s}catch(t){(0,h.YM)(t,e)}}var v=s(44347),f=s(13511),I=s(99452),y=s.n(I),S=s(38541),w=s.n(S),b=s(81353),C=s(6132),x=s(49972),R=s(56096);let _=C.z.object({memoryReferences:C.z.array(C.z.object({conversationId:C.z.string()})).optional().catch(void 0),deepsearchPreset:C.z.string().optional().catch(void 0),ui_layout:C.z.object({reasoningUiLayout:C.z.enum(["UNIFIED","SPLIT"]).optional().catch(void 0)}).optional().catch(void 0),artifactAction:C.z.enum(["ask","explain"]).optional().catch(void 0),agenticWorkspace:C.z.object({workspaceId:C.z.string()}).optional().catch(void 0),requestModelDetails:C.z.object({modelId:C.z.string().nullish(),name:C.z.string().nullish(),description:C.z.string().nullish()}).optional().catch(void 0),modelConfigOverride:v.DC.optional().catch(void 0),isMozart:C.z.boolean().optional().catch(void 0),parentQuotedText:C.z.string().optional().catch(void 0)}),k={nodesPromisesByConversationId:{},nodesByConversationId:{},initialResponsesPromisesByConversationId:{},loadMoreResponsesPromisesByConversationId:{},previewResponsesPromisesByConversationIdResponseId:{},conversationImageResponsesPromisesByConversationId:{},byId:{},byConversationId:{},imageIdByUrl:{},inflightPromisesByConversationId:{}};class T{constructor(e,t){var s=this;this.set=e,this.get=t,this.nodesPromisesByConversationId=k.nodesPromisesByConversationId,this.nodesByConversationId=k.nodesByConversationId,this.initialResponsesPromisesByConversationId=k.initialResponsesPromisesByConversationId,this.loadMoreResponsesPromisesByConversationId=k.loadMoreResponsesPromisesByConversationId,this.previewResponsesPromisesByConversationIdResponseId=k.previewResponsesPromisesByConversationIdResponseId,this.conversationImageResponsesPromisesByConversationId=k.conversationImageResponsesPromisesByConversationId,this.byId=k.byId,this.byConversationId=k.byConversationId,this.imageIdByUrl=k.imageIdByUrl,this.inflightPromisesByConversationId=k.inflightPromisesByConversationId,this.upsertResponse=(0,c.el)(this.set,"byId","responseId"),this.appendResponses=(0,c.BC)(this.set,"byId","responseId"),this.removeResponse=(0,c.TF)(this.set,"byId"),this.idsertInitialResponsesPromisesByConversationId=(0,c.q5)(this.set,"initialResponsesPromisesByConversationId"),this.removeInitialResponsesPromiseByConversationId=(0,c.TF)(this.set,"initialResponsesPromisesByConversationId"),this.idsertLoadMoreResponsesPromisesByConversationId=(0,c.q5)(this.set,"loadMoreResponsesPromisesByConversationId"),this.removeLoadMoreResponsesPromiseByConversationId=(0,c.TF)(this.set,"loadMoreResponsesPromisesByConversationId"),this.idsertPreviewResponsesPromisesByConversationIdResponseId=(0,c.q5)(this.set,"previewResponsesPromisesByConversationIdResponseId"),this.removePreviewResponsesPromiseByConversationIdResponseId=(0,c.TF)(this.set,"previewResponsesPromisesByConversationIdResponseId"),this.idsertConversationImageResponsesPromisesByConversationId=(0,c.q5)(this.set,"conversationImageResponsesPromisesByConversationId"),this.removeConversationImageResponsesPromiseByConversationId=(0,c.TF)(this.set,"conversationImageResponsesPromisesByConversationId"),this.setOneImageIdByUrl=(0,c.q5)(this.set,"imageIdByUrl"),this.idsertInflightPromisesByConversationId=(0,c.q5)(this.set,"inflightPromisesByConversationId"),this.idsertNodesByConversationId=(0,c.q5)(this.set,"nodesByConversationId"),this.idsertNodesPromisesByConversationId=(0,c.q5)(this.set,"nodesPromisesByConversationId"),this.removeNodesPromise=(0,c.TF)(this.set,"nodesPromisesByConversationId"),this.fetchListResponseNodes=async e=>{let t=this.get();if(t.nodesByConversationId[e])return t.nodesByConversationId[e];if(e in t.nodesPromisesByConversationId)return t.nodesPromisesByConversationId[e];let s=u.chatApi.chatListResponseNodes({conversationId:e}).then(e=>{let{responseNodes:t=[]}=e;return t});return t.idsertNodesPromisesByConversationId(s,e),s.then(s=>{t.idsertNodesByConversationId(s,e)}).catch(console.error).finally(()=>{t.removeNodesPromise(e)}),s},this.fetchListInflightResponses=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=s.get();if(!t&&e in n.inflightPromisesByConversationId)return n.inflightPromisesByConversationId[e];let o=u.chatApi.chatListResponseNodes({conversationId:e}).then(e=>{let{inflightResponses:t=[]}=e;return t});return n.idsertInflightPromisesByConversationId(o,e),o.then(n.appendResponses).catch(console.error),o},this.loadResponses=async(e,t)=>{let s=this.get(),n=t.filter(e=>!s.byId[e]);if(n.length){var o;let t=((null==(o=await u.chatApi.chatLoadResponses({conversationId:e,body:{responseIds:n}}))?void 0:o.responses)||[]).map(t=>{let s=_.optional().parse(t.metadata),{toolUsageResultById:n,traceSteps:o}=U(t.steps);return{...t,conversationId:e,memoryReferences:null==s?void 0:s.memoryReferences,deepsearchPreset:null==s?void 0:s.deepsearchPreset,parentQuotedText:null==s?void 0:s.parentQuotedText,toolUsageResultById:n,traceSteps:o}});s.appendResponses(t)}return t.map(e=>this.get().byId[e]).sort((e,t)=>new Date(e.createTime).getTime()-new Date(t.createTime).getTime())},this.loadInitialResponses=async e=>{let t=this.get(),s=t.initialResponsesPromisesByConversationId[e];if(s)return s;let n=t.nodesPromisesByConversationId[e];return n||(n=this.fetchListResponseNodes(e)),s=(async()=>{try{let s=await n;if(!s.length)return[];let o=s[s.length-1],i=(0,r.d7)(o.responseId||"",s,30).filter(e=>!!e.responseId).map(e=>e.responseId);return t.loadResponses(e,i)}catch(e){return console.error(e),[]}})().finally(()=>{t.removeInitialResponsesPromiseByConversationId(e)}),t.idsertInitialResponsesPromisesByConversationId(s,e),s},this.loadMoreResponses=async(e,t)=>{let s=this.get(),n=s.nodesByConversationId[e];if(!n.length)return[];if(e in s.initialResponsesPromisesByConversationId)return s.initialResponsesPromisesByConversationId[e];let o=s.loadMoreResponsesPromisesByConversationId[e];return o||(o=(async()=>{try{let o=s.byConversationId[e]||[],i=(0,r.d7)(t,n),a=(0,r.m$)(i,o),l=i.findIndex(e=>e.responseId===(null==a?void 0:a.responseId)),d=i.slice(l+1,l+30+1).filter(e=>!!e.responseId).map(e=>e.responseId);return s.loadResponses(e,d)}catch(e){return console.error(e),[]}})().finally(()=>{s.removeLoadMoreResponsesPromiseByConversationId(e)}),s.idsertLoadMoreResponsesPromisesByConversationId(o,e)),o},this.loadPreviewResponses=async(e,t)=>{let s=this.get(),n=s.nodesPromisesByConversationId[e];n||(n=this.fetchListResponseNodes(e));let o=s.previewResponsesPromisesByConversationIdResponseId[e+t];return o||(o=(async()=>{try{let o=await n,i=(0,r.d7)(o[o.length-1].responseId,o);if(!i.length)return{responses:[],hasOlderResponses:!1,hasNewerResponses:!1};let a=[];if(t&&i.some(e=>e.responseId===t)){let e=i.findIndex(e=>e.responseId===t),s=Math.max(0,e-5);a=i.slice(s,e+5+1).map(e=>e.responseId)}else a=i.slice(0,10).map(e=>e.responseId);let l=i[i.length-1],d=i[0],c=await s.loadResponses(e,a);return{responses:c,hasOlderResponses:!(null==c?void 0:c.some(e=>e.responseId===l.responseId)),hasNewerResponses:!(null==c?void 0:c.some(e=>e.responseId===d.responseId))}}catch(e){return console.error(e),{responses:[],hasOlderResponses:!1,hasNewerResponses:!1}}})(),s.idsertPreviewResponsesPromisesByConversationIdResponseId(o,e+t)),o},this.loadConversationBranch=async(e,t,s)=>{let n=this.get(),o=n.nodesByConversationId[e];if(!o.length)return[];let i=(0,r.d7)(t,o),a=i.slice(0,i.findIndex(e=>e.responseId===s)+1).filter(e=>!!e.responseId).map(e=>e.responseId);return n.loadResponses(e,a)},this.loadConversationImageResponses=async e=>{let t=this.get(),s=t.nodesPromisesByConversationId[e];s||(s=this.fetchListResponseNodes(e));let n=t.conversationImageResponsesPromisesByConversationId[e];return n||(n=(async()=>{try{let n=(await s).map(e=>e.responseId);return await t.loadResponses(e,n)}catch(e){return console.error(e),[]}})().finally(()=>{t.removeConversationImageResponsesPromiseByConversationId(e)}),t.idsertConversationImageResponsesPromisesByConversationId(n,e)),n},this.processResponseChunk=e=>{var t,s,n,o,i,r,a,l,d;let{currentStreamResponse:c,responseChunk:u,onCitations:h,onHasImage:m,onDisclaimer:p,onFollowUpSuggestedMode:g,onUiLayout:v}=e,f=this.get(),{responseId:I,token:y,modelResponse:S,webSearchResults:b,citedWebSearchResults:C,xSearchResults:x,queryAction:R,cachedImageGenerationResponse:_,followUpSuggestions:k,cardAttachment:T,streamingImageGenerationResponse:M,finalMetadata:P,isThinking:E,messageTag:B,messageStepId:N,bannerMessage:A,disclaimer:z,imageAttachmentInfo:V,progressReport:L,memoryReferences:U,imageDimensions:j,followUpSuggestedMode:D,uiLayout:O,authNotification:F,toolUsageCardId:q}=u;if(void 0!=N&&c.steps.length<=N&&(c.steps=[...c.steps,...w().map(Array(N-c.steps.length+1),()=>({text:[],tags:[],webSearchResults:[],xpostIds:[],xposts:[],toolUsageResults:[]}))]),I&&c.inflightResponseId!==I&&(c.inflightResponseId=I),R&&(("aurora"===R.type||"flux"===R.type)&&(c.hasImages=!0,m()),"x"===R.type&&(c.hasSearches=!0)),V&&V.imageAttachmentCount&&(c.imageAttachmentCount=V.imageAttachmentCount),j&&(j.height&&(c.generatedImageHeight=j.height),j.width&&(c.generatedImageWidth=j.width)),null==b?void 0:b.results)if(void 0!=N){let e=c.steps[N];if(e.webSearchResults=b.results||[],q){let t={toolUsageCardId:q,webSearchResults:{results:b.results}};e.toolUsageResults=[...e.toolUsageResults||[],t]}}else 0===c.steps.length&&(c.webSearchResults=[...c.webSearchResults||[],...b.results||[]],h());if(null==x?void 0:x.results)if(void 0!=N){let e=c.steps[N];if(e){if(e.xposts=x.results||[],e.xpostIds=w().compact(e.xposts.map(e=>e.postId)),q){let t={toolUsageCardId:q,xSearchResults:{results:x.results}};e.toolUsageResults=[...e.toolUsageResults||[],t]}}else c.steps.push({text:[],tags:[],webSearchResults:[],xpostIds:w().compact(x.results.map(e=>e.postId)),xposts:x.results||[],toolUsageResults:q?[{toolUsageCardId:q,xSearchResults:{results:x.results}}]:[]})}else 0===c.steps.length&&(c.xposts=[...c.xposts||[],...x.results||[]],c.xpostIds=w().compact(c.xposts.map(e=>e.postId)),h());if((null==C?void 0:C.results)&&(c.citedWebSearchResults=[...c.citedWebSearchResults||[],...C.results||[]],h()),_&&_.imageUrl&&(c.generatedImageUrls=c.generatedImageUrls.concat([_.imageUrl])),T&&T.jsonData&&(c.cardAttachmentsJson=c.cardAttachmentsJson.concat([T.jsonData])),U&&(null==(t=U.references)?void 0:t.length)&&(c.memoryReferences=U.references),E&&!c.liveThinkingStartTime&&(c.liveThinkingStartTime=new Date(c.createTime).getTime()),"summary"===B?(y&&(y.includes("xai:tool_usage_card")?c.traceSteps.push({type:"tool",text:y}):c.traceSteps.push({type:"summary",text:y})),q&&(b&&(null!=(s=c.toolUsageResultById)[q]||(s[q]={}),c.toolUsageResultById={...c.toolUsageResultById,[q]:{...c.toolUsageResultById[q],webSearchResults:b}},c.webSearchResults=[...c.webSearchResults||[],...b.results||[]]),x&&(null!=(o=c.toolUsageResultById)[q]||(o[q]={}),c.toolUsageResultById={...c.toolUsageResultById,[q]:{...c.toolUsageResultById[q],xSearchResults:x}},c.xposts=[...c.xposts||[],...x.results||[]]))):"header"===B&&y&&c.traceSteps.push({type:"header",text:y}),y)if(B&&"UNSET"!==B.toUpperCase()){if(c.searchingStartTime||(c.searchingStartTime=new Date(c.createTime).getTime()),"FINAL"===B.toUpperCase())c.searchingStartTime&&!c.searchingEndTime&&(c.searchingEndTime=Date.now()),c.message+=y;else if(null!=N){let e=c.steps[N];if(e)if(e.tags.includes(B)){let t=e.tags.indexOf(B);t>=0&&(e.text[t]+=y)}else e.text.push(y),e.tags.push(B)}}else E?c.thinkingTrace+=y:c.message+=y;if(c.liveThinkingStartTime&&!c.liveThinkingEndTime&&!E&&y&&(c.liveThinkingEndTime=Date.now()),k&&k.suggestions&&(c.suggestions=k.suggestions),D&&(c.followUpSuggestedMode=D,g(D)),P&&(P.followUpSuggestions&&(c.suggestions=P.followUpSuggestions),P.disclaimer&&p(P.disclaimer,c.conversationId)),M){let{imageId:e,imageUrl:t}=M;if(e&&t){let s=null!=(r=c.streamingImageById)?r:{};M.progress&&(c.streamingImageById={...s,[e]:{...null!=(a=s[e])?a:{},[M.progress]:M}}),f.setOneImageIdByUrl(e,t)}}return A&&A.message&&p(A.message,c.conversationId),z&&z.message&&p(z.message,c.conversationId),L&&(c.progressReport=L),O&&(c.uiLayout={...null!=(l=c.uiLayout)?l:{},...O},null==v||v(c.uiLayout)),F&&(c.authNotification={...null!=(d=c.authNotification)?d:{},...F}),S&&(c={...c,...S,state:c.authNotification?"streaming":"closed"}),c},this.processSideBySide=e=>{let{responseChunk:t,toggledExperiment:s,conversationId:n,parentResponseId:o,userResponseId:i,modelName:r}=e,{sideBySideIndex:a,responseId:l}=t;if(null!=a&&!s){let e="streaming_in_progress_".concat(a,"_").concat(y()());return A({conversationId:n,responseId:l||e,parentResponseId:i||o,sender:r})}},this.processSoftStop=e=>{let{currentStreamResponse:t,responseChunk:s,startTimeMs:n}=e;return t.liveThinkingStartTime&&!t.liveThinkingEndTime&&(t.liveThinkingEndTime=Date.now()),t.generationTimeMs=Date.now()-n,t.state="closed",s.responseId&&(t.responseId=s.responseId),t.partial=!1,t},this.streamResponse=e=>{var t,s,c;let h,{message:m,metadata:p={},parentResponseId:I,parentQuotedText:w,conversationId:b,modelName:C,fileAttachmentIds:_,webpageUrls:k,toolOverrides:T,customInstructions:P,customPersonality:E,deepsearchPreset:V,systemPromptName:U,isReasoning:j,imageEditUri:D,followUpType:O,enableRetries:F,disableArtifactDiff:q,onOptimisticUserResponse:G,onOptimisticModelResponse:Q,onStart:$,onUserResponse:W,onStartExperiment:H,onCitations:K,onDisclaimer:J,onHasImage:X,onClose:Z,onWke:Y,onError:ee,isFromGrokFiles:et,resumeResponseId:es,disableToolComposer:en=!1,disableMemory:eo=!1,ff:ei}=e,er=x.w.getState(),ea=this.get(),el=(0,n.f)(),ed=new AbortController;er.idsertAbortControllerById(ed,b);let ec=R.x.getState().bestSubscription,eu=[],eh=!m;if(eh||(h=N({conversationId:b,responseId:"optimistic_query_".concat(y()()),parentResponseId:I,message:m,parentQuotedText:w,fileAttachments:_,webpageUrls:k,state:"optimistic"}),ea.upsertResponse(h),G(h)),!eh&&(0,S.isEmpty)(I)){let e=null==(t=ea.byConversationId[b])?void 0:t.length,s=(0,r.Po)(ea.byConversationId[b]);(0,d.$s)("root_pivot",s,{conversationId:b,totalResponses:String(e),longestBranchLength:String(s)})}let em="streaming_in_progress_".concat(y()()),ep="",eg="";if(es&&ea.byId[es]){let e=ea.byId[es];ep=e.message,eg=e.thinkingTrace}let ev=A({conversationId:b,responseId:em,parentResponseId:eh?I:null==h?void 0:h.responseId,sender:C,state:"optimistic",message:ep,thinkingTrace:eg},V,j);eu.push(ev),ea.upsertResponse(ev),Q(ev);let{modelConfigOverrideByModel:ef,isToolComposer2:eI,sideBySideMode:ey}=v.C$.getState(),eS=null!=(s=ef[C||"undefined"])?s:{};if((0,v.Qy)(eS)){let e={...eS};e.useToolOverrides||delete e.tools,e.useSideBySideParams||delete e.sideBySideParams,p.modelConfigOverride=e}!en&&(null!=eI?eI:ei.DEFAULT_USE_TOOL_COMPOSER2)&&(p.isMozart=!0);let ew=(c={parentResponseId:I,parentQuotedText:w,message:m,metadata:{...p,requestModelDetails:(0,o.I2)(C,ei)},modelName:C,fileAttachments:_,webpageUrls:k,toolOverrides:T,enableSideBySide:"never"!==ey&&!el,forceSideBySide:"always"===ey,systemPromptName:U,customInstructions:P,customPersonality:E,deepsearchPreset:V,disableArtifactDiff:q,isReasoning:j,imageEditUri:D,followUpType:O,isFromGrokFiles:et,resumeResponseId:es,disableMemory:eo},{message:"",modelName:"",parentResponseId:"",parentQuotedText:void 0,systemPromptName:void 0,disableSearch:!1,imageAttachments:[],returnImageBytes:!1,returnRawGrokInXaiRequest:!1,fileAttachments:[],enableImageGeneration:!0,forceConcise:!1,enableImageStreaming:!0,enableSideBySide:!0,sendFinalMetadata:!0,imageGenerationCount:B,deepsearchPreset:"",isReasoning:!1,disableTextFollowUps:!0,followUpType:"",disableMemory:!1,...c}),eb=!1,eC=!1,ex=!1,eR=Date.now(),[e_,ek]=z(),{log:eT,stop:eM,resetTime:eP}=(0,a.Pp)("streamResponse",{type:"milliseconds_per_token",subscriptionTier:ec||"unknown",modelId:C,modelMode:(0,i.yv)({isReasoning:j,deepsearchPreset:V}),millisecondsPerTokenList:[]}),eE=(0,a.wl)("streamResponse",{type:"time_to_first_token",modelId:C,subscriptionTier:ec||"unknown",modelMode:(0,i.yv)({isReasoning:j,deepsearchPreset:V}),timeToFirstTokenMs:0},e=>{eu.forEach(t=>{t.liveTimeToFirstTokenMs=e})}),eB=(0,a.hl)("streamResponse",{type:"time_to_first_chunk",modelId:C,subscriptionTier:ec||"unknown",modelMode:(0,i.yv)({isReasoning:j,deepsearchPreset:V}),timeToFirstChunkMs:0},e=>{eu.forEach(t=>{t.liveTimeToFirstChunkMs=e})});return u.chatApi.chatAddResponseRaw({conversationId:b,body:ew}).then(async e=>{for await(let r of(h&&(h.state="streaming",ek(h)),(eu=eu.map(e=>({...e,state:"streaming"}))).forEach(ek),$(eu),(0,a.N8)("streamResponse",{type:"send_query_stream_start",subscriptionTier:ec||"unknown",modelId:C,modelMode:(0,i.yv)({isReasoning:j,deepsearchPreset:V})}),eP(),g(e.raw))){var t,s,n,o;if(eB(),eT(),r.error){let e=Error(r.error.message);throw Y(e),e}if(!r.result)continue;let e=r.result,{userResponse:i,sideBySideIndex:l,isSoftStop:c,modelResponse:u,authNotification:m}=e;if(null==i?void 0:i.error)throw h&&(h.state="error",h.error=i.error,ek(h)),(0,a.vV)("response-store:streamResponse:userResponseChunk",i.error),Error(i.error);if(null==u?void 0:u.error)throw(eu=eu.map(e=>({...e,state:"error",error:u.error}))).forEach(ek),(0,a.vV)("response-store:streamResponse:modelResponseChunk",u.error),Error(u.error);let p=this.processSideBySide({responseChunk:e,toggledExperiment:eb,conversationId:b,parentResponseId:I,userResponseId:null==h?void 0:h.responseId,modelName:C});if(p&&(eb=!0,p.uiLayout=null==(t=eu[0])?void 0:t.uiLayout,eu.push(p),ek(p),H(eu.map(e=>e.responseId))),i){e_(h={...i,conversationId:b,state:"closed",parentQuotedText:w}),W(h),eC=!0,(eu=eu.map(e=>({...e,parentResponseId:null==h?void 0:h.responseId}))).forEach(ek);continue}let g=null!=l?l:0,v=eu[g];if(!v)return;v=this.processResponseChunk({currentStreamResponse:v,responseChunk:e,onCitations:()=>K(v),onHasImage:X,onDisclaimer:J,onFollowUpSuggestedMode:e=>{var t;(0,d.$s)("follow_up_suggested_mode_button_shown",e.mode,{responseId:v.responseId,followUpSuggestedMode:null!=(t=e.mode)?t:"UNKNOWN"})},onUiLayout:e=>{eu=eu.map(t=>{var s;return{...t,uiLayout:{...null!=(s=t.uiLayout)?s:{},...e}}})}}),(e.token||e.messageTag)&&eE(),e_(v),eu[g]=v,c&&(v=this.processSoftStop({currentStreamResponse:v,responseChunk:e,startTimeMs:eR}),(0,d.$s)("generation_time_ms",v.generationTimeMs,{conversationId:b,responseId:v.responseId}),ek(v),eu.every(e=>"closed"===e.state)&&((0,d.$s)("finished_query",null==(s=eu[0])?void 0:s.responseId,{conversationId:b,toggledExperiment:eb.toString(),secondResponse:(null==(n=eu[1])?void 0:n.responseId)||"",isReasoning:j?j.toString():"",deepsearchPreset:V||""}),eu.forEach(ek),Z(eu,eu.map(e=>e.responseId)),ex=!0)),m&&((0,d.$s)("auth_notification_received",null==(o=eu[0])?void 0:o.responseId,{conversationId:b}),ex=!0)}if(eC||eh||(this.ensureUserResponseSaved({conversationId:b,message:m,userResponse:h,onUserResponse:W,forceUpsertResponse:ek}).then(L(eu)).then(e=>eu=e).catch((0,a.HX)("response-store:useResponseStore:streamResponse")),eC=!0),!ex){let e=Error(f.CZ);(0,a.vV)("response-store:useResponseStore:streamResponse:closedStream",e)}(0,a.N8)("streamResponse",{type:"send_query_stream_success",subscriptionTier:ec||"unknown",modelId:C,modelMode:(0,i.yv)({isReasoning:j,deepsearchPreset:V})})}).catch(e=>{(0,l.GQ)(e)&&((0,a.vV)("response-store:useResponseStore:streamResponse",e),(0,a.N8)("streamResponse",{type:"send_query_stream_error",subscriptionTier:ec||"unknown",modelId:C,modelMode:(0,i.yv)({isReasoning:j,deepsearchPreset:V})}));let t=ee(e);if(F&&t)M(C,b,eu,j,V,$,K,J,X,Z,Y).catch(e=>{throw(0,a.vV)("response-store:useResponseStore:streamResponse:handleStreamError",e),e});else throw(eu=eu.map(e=>({...e,state:"error",compoutedThinkingEndTime:e.liveThinkingStartTime&&!e.liveThinkingEndTime?Date.now():e.liveThinkingEndTime,searchingEndTime:e.searchingStartTime&&!e.searchingEndTime?Date.now():e.searchingEndTime}))).forEach(ek),e}).finally(()=>{eM()})},this.reconnectToResponse=e=>{let{inflightResponse:t,conversationId:s,modelName:n,parentResponseId:o,enableRetries:r,isReasoning:l,deepsearchPreset:c,onStart:h,onCitations:m,onDisclaimer:p,onHasImage:v,onClose:I,onWke:S,onError:w}=e,b=this.get(),C=x.w.getState(),_=new AbortController,k=R.x.getState().bestSubscription,T=!1;if(!t.responseId)throw Error("Inflight response missing responseId");let P=[],E={type:"milliseconds_per_token",subscriptionTier:k||"unknown",modelId:n,modelMode:(0,i.yv)({isReasoning:l,deepsearchPreset:c}),millisecondsPerTokenList:[]},{log:B,stop:N,resetTime:V}=(0,a.Pp)("reconnectToResponse",E);return u.chatApi.chatReconnectResponseV2Raw({responseId:t.responseId}).then(async e=>{var u,y,w,x,R,M,E,N,L,U,j,D,O,F,q,G,Q,$,W,H,K;(0,a.N8)("reconnectToResponse",{type:"send_query_stream_reconnect_start",subscriptionTier:k||"unknown",modelId:n,modelMode:(0,i.yv)({isReasoning:l,deepsearchPreset:c})}),V();let J=g(e.raw);B();let X=await J.next();if(!(null==(u=X.value)?void 0:u.result)||!(null==(x=X.value)||null==(w=x.result)||null==(y=w.response)?void 0:y.modelResponse))throw Error("No initial state received from reconnect");let{title:Z,response:Y}=X.value.result;if(Z){let e=C.byId[s];C.upsertAndCacheConversation({...e,title:Z.newTitle})}let ee=A({...Y.modelResponse,responseId:t.responseId,inflightResponseId:t.responseId,conversationId:s,parentResponseId:o,sender:n,state:"streaming",...t.createTime&&{createTime:t.createTime}});if(((null==(R=Y.queryAction)?void 0:R.type)==="aurora"||(null==(M=Y.queryAction)?void 0:M.type)==="flux")&&(ee.hasImages=!0,v()),(null==(E=Y.queryAction)?void 0:E.type)==="x"&&(ee.hasSearches=!0),(null==(N=Y.followUpSuggestions)?void 0:N.suggestions)&&(ee.suggestions=Y.followUpSuggestions.suggestions),Y.followUpSuggestedMode&&(ee.followUpSuggestedMode=Y.followUpSuggestedMode),Y.finalMetadata&&(Y.finalMetadata.followUpSuggestions&&(ee.suggestions=Y.finalMetadata.followUpSuggestions),Y.finalMetadata.disclaimer&&p(Y.finalMetadata.disclaimer,ee.conversationId)),Y.cachedImageGenerationResponse&&Y.cachedImageGenerationResponse.imageUrl&&(ee.generatedImageUrls=ee.generatedImageUrls.concat([Y.cachedImageGenerationResponse.imageUrl])),Y.cardAttachment&&Y.cardAttachment.jsonData&&(ee.cardAttachmentsJson=ee.cardAttachmentsJson.concat([Y.cardAttachment.jsonData])),(null==(U=Y.modelResponse)||null==(L=U.steps)?void 0:L.length)&&(ee.searchingStartTime=new Date(ee.createTime).getTime(),(null==(G=Y.modelResponse)?void 0:G.message)&&(ee.searchingEndTime=Date.now())),(null==(j=Y.modelResponse)?void 0:j.thinkingTrace)&&(ee.liveThinkingStartTime=new Date(ee.createTime).getTime(),Y.isThinking||ee.liveThinkingEndTime||(ee.liveThinkingEndTime=Date.now())),Y.bannerMessage&&Y.bannerMessage.message&&p(Y.bannerMessage.message,ee.conversationId),Y.disclaimer&&Y.disclaimer.message&&p(Y.disclaimer.message,ee.conversationId),(null==(D=Y.modelResponse)?void 0:D.uiLayout)&&(ee.uiLayout=null==(Q=Y.modelResponse)?void 0:Q.uiLayout),P=[ee],C.idsertAbortControllerById(_,s),b.upsertResponse(ee),h(P),Y.streamingImageGenerationResponse){let{imageId:e,imageUrl:t}=Y.streamingImageGenerationResponse;if(e&&t){let s=null!=($=ee.streamingImageById)?$:{};Y.streamingImageGenerationResponse.progress&&(ee.streamingImageById={...s,[e]:{...null!=(W=s[e])?W:{},[Y.streamingImageGenerationResponse.progress]:Y.streamingImageGenerationResponse}}),b.setOneImageIdByUrl(e,t)}}((null==(O=ee.webSearchResults)?void 0:O.length)||(null==(F=ee.citedWebSearchResults)?void 0:F.length)||(null==(q=ee.xposts)?void 0:q.length))&&m(ee);let[et,es]=z(),en=new Date(ee.createTime).getTime();try{for await(let e of J){if(B(),e.error){let t=Error(e.error.message);throw S(t),t}if(!e.result)continue;let{title:t,response:n}=e.result;if(null==t?void 0:t.newTitle){let e=C.byId[s];C.upsertAndCacheConversation({...e,title:t.newTitle})}if(n){if(null==(H=n.modelResponse)?void 0:H.error)throw(0,a.vV)("response-store:reconnectToResponse:modelResponse",n.modelResponse.error),Error(n.modelResponse.error);ee={...this.processResponseChunk({currentStreamResponse:ee,responseChunk:n,onCitations:()=>m(ee),onHasImage:v,onDisclaimer:p,onFollowUpSuggestedMode:e=>{var t;(0,d.$s)("follow_up_suggested_mode_button_shown",e.mode,{responseId:ee.responseId,followUpSuggestedMode:null!=(t=e.mode)?t:"UNKNOWN"})}}),parentResponseId:o},et(ee),P[0]=ee,n.isSoftStop&&(ee=this.processSoftStop({currentStreamResponse:ee,responseChunk:n,startTimeMs:en}),(0,d.$s)("generation_time_ms",ee.generationTimeMs,{conversationId:s,responseId:ee.responseId}),es(ee),P.every(e=>"closed"===e.state)&&((0,d.$s)("finished_query",null==(K=P[0])?void 0:K.responseId,{conversationId:s,isReasoning:l?l.toString():"",deepsearchPreset:c||""}),P.forEach(es),I(P,P.map(e=>e.responseId)),T=!0)),n.authNotification&&(T=!0)}}if(!T){let e=Error(f.CZ);(0,a.vV)("response-store:useResponseStore:reconnectToResponse:closedStream",e)}(0,a.N8)("reconnectToResponse",{type:"send_query_stream_reconnect_success",subscriptionTier:k||"unknown",modelId:n,modelMode:(0,i.yv)({isReasoning:l,deepsearchPreset:c})})}catch(e){throw r||(ee={...ee,state:"error",liveThinkingEndTime:ee.liveThinkingStartTime&&!ee.liveThinkingEndTime?Date.now():ee.liveThinkingEndTime,searchingEndTime:ee.searchingStartTime&&!ee.searchingEndTime?Date.now():ee.searchingEndTime},P[0]=ee,es(ee)),e}}).catch(e=>{(0,a.vV)("response-store:reconnectToResponse",e),(0,a.N8)("reconnectToResponse",{type:"send_query_stream_reconnect_error",subscriptionTier:k||"unknown",modelId:n,modelMode:(0,i.yv)({isReasoning:l,deepsearchPreset:c})});let t=w(e);if(r&&t)M(n,s,P,l,c,h,m,p,v,I,S).catch(e=>{throw(0,a.vV)("response-store:reconnectToResponse:handleStreamError",e),e});else{if(0===P.length){let e=A({conversationId:s,responseId:"streaming_in_progress_".concat(y()()),parentResponseId:o,sender:n,state:"error"});P=[e],b.upsertResponse(e)}throw e}}).finally(()=>{C.removeAbortControllerById(s),N()})},this.streamCreateAndRespond=async e=>{var t,s;let{temporary:r,message:c,modelName:h,fileAttachmentIds:m,webpageUrls:p,systemPromptName:I,personaId:S,toolOverrides:w,isPreset:b,customInstructions:C,customPersonality:_,deepsearchPreset:k,isReasoning:T,imageEditUri:P,enableRetries:E,disableArtifactDiff:V,onOptimisticConversation:U,onOptimisticResponse:j,onStart:D,onConversation:O,onUserResponse:F,onStartExperiment:q,onCitations:G,onDisclaimer:Q,onHasImage:$,onClose:W,onWke:H,onError:K,workspaceIds:J,responseMetadata:X={},isFromGrokFiles:Z,disableToolComposer:Y=!1,disableMemory:ee=!1,ff:et}=e,es=this.get(),en=x.w.getState(),eo=(0,n.f)(),ei=R.x.getState().bestSubscription,er="optimistic_conversation_".concat(y()()),ea=(0,x.b)({conversationId:er,personaId:S,temporary:r});en.upsertAndCacheConversation(ea),U(ea);let el="optimistic_response_".concat(y()()),ed=N({conversationId:ea.conversationId,responseId:el,message:c,fileAttachments:m,webpageUrls:p});es.upsertResponse(ed),j(ed);let ec="streaming_in_progress_".concat(y()()),eu=A({conversationId:ea.conversationId,responseId:ec,parentResponseId:ed.responseId,sender:h},k,T),eh=[eu];es.upsertResponse(eu);let{modelConfigOverrideByModel:em,isToolComposer2:ep,sideBySideMode:eg}=v.C$.getState(),ev=null!=(t=em[h||"undefined"])?t:{};if((0,v.Qy)(ev)){let e={...ev};e.useToolOverrides||delete e.tools,e.useSideBySideParams||delete e.sideBySideParams,X.modelConfigOverride=e}!Y&&(null!=ep?ep:et.DEFAULT_USE_TOOL_COMPOSER2)&&(X.isMozart=!0);let ef=(s={temporary:r,message:c,modelName:h,fileAttachments:m,webpageUrls:p,systemPromptName:null!=I?I:S,toolOverrides:w,enableSideBySide:"never"!==eg&&!eo,forceSideBySide:"always"===eg,customInstructions:C,customPersonality:_,deepsearchPreset:k,isReasoning:T,disableArtifactDiff:V,imageEditUri:P,workspaceIds:J,isFromGrokFiles:Z,responseMetadata:{...X,requestModelDetails:(0,o.I2)(h,et)},disableMemory:ee},{systemPromptName:"",temporary:!1,message:"",modelName:"",fileAttachments:[],imageAttachments:[],disableSearch:!1,enableImageGeneration:!0,returnImageBytes:!1,returnRawGrokInXaiRequest:!1,enableImageStreaming:!0,imageGenerationCount:B,forceConcise:!1,enableSideBySide:!0,sendFinalMetadata:!0,disableTextFollowUps:!0,...s}),eI=new AbortController;en.idsertAbortControllerById(eI,er);let ey=!1,eS=!1,ew=!1,eb=Date.now(),[eC,ex]=z(),{log:eR,stop:e_,resetTime:ek}=(0,a.Pp)("streamCreateAndRespond",{type:"milliseconds_per_token",subscriptionTier:ei||"unknown",modelId:h,modelMode:(0,i.yv)({isReasoning:T,deepsearchPreset:k}),millisecondsPerTokenList:[]}),eT=(0,a.wl)("streamCreateAndRespond",{type:"time_to_first_token",modelId:h,subscriptionTier:ei||"unknown",modelMode:(0,i.yv)({isReasoning:T,deepsearchPreset:k}),timeToFirstTokenMs:0},e=>{eh.forEach(t=>{t.liveTimeToFirstTokenMs=e})}),eM=(0,a.hl)("streamCreateAndRespond",{type:"time_to_first_chunk",modelId:h,subscriptionTier:ei||"unknown",modelMode:(0,i.yv)({isReasoning:T,deepsearchPreset:k}),timeToFirstChunkMs:0},e=>{eh.forEach(t=>{t.liveTimeToFirstChunkMs=e})});return u.chatApi.chatCreateConversationAndRespondRaw({body:ef}).then(async e=>{for await(let o of(ed={...ed,state:"streaming"},eh=eh.map(e=>({...e,state:"streaming"})),ex(ed),eh.forEach(ex),D(eh),(0,a.N8)("streamCreateAndRespond",{type:"send_query_stream_start",subscriptionTier:ei||"unknown",modelId:h,modelMode:(0,i.yv)({isReasoning:T,deepsearchPreset:k})}),ek(),g(e.raw))){if(eM(),eR(),o.error){let e=Error(o.error.message);throw H(e),e}if(!o.result)continue;let{response:e,conversation:i,title:r}=o.result;if(i){let e=ea.conversationId;ea={...ea,isNew:!0,fromPreset:b,state:"closed",systemPromptName:"",...i},en.upsertAndCacheConversation(ea,e),en.idsertAbortControllerById(eI,ea.conversationId),ed={...ed,conversationId:ea.conversationId},eh=eh.map(e=>({...e,parentResponseId:ed.responseId,conversationId:ea.conversationId})),eC(ed),eh.forEach(ex),O(ea);continue}if((null==r?void 0:r.newTitle)&&(ea={...ea,title:r.newTitle},en.upsertAndCacheConversation(ea)),e){var t,s,n;let{userResponse:o,sideBySideIndex:i,isSoftStop:r,modelResponse:l,authNotification:c}=e;if(null==o?void 0:o.error)throw ex(ed={...ed,...o,state:"error"}),(0,a.vV)("response-store:useResponseStore:streamResponse:userResponseChunk",o.error),Error(o.error);if(null==l?void 0:l.error)throw(eh=eh.map(e=>({...e,...l,state:"error"}))).forEach(ex),(0,a.vV)("response-store:useResponseStore:streamResponse:modelResponseChunk",l.error),Error(l.error);let u=this.processSideBySide({responseChunk:e,toggledExperiment:ey,conversationId:ea.conversationId,parentResponseId:ed.responseId,modelName:h});if(u&&(ey=!0,u.uiLayout=null==(t=eh[0])?void 0:t.uiLayout,eh.push(u),ex(u),q(eh.map(e=>e.responseId))),o){eC(ed={...ed,...o,conversationId:ea.conversationId,state:"closed"}),F(ed),eS=!0,(eh=eh.map(e=>({...e,parentResponseId:null==ed?void 0:ed.responseId}))).forEach(ex);continue}let m=null!=i?i:0,p=eh[m];if(!p)continue;p=this.processResponseChunk({currentStreamResponse:p,responseChunk:e,onCitations:()=>G(p),onHasImage:$,onDisclaimer:Q,onFollowUpSuggestedMode:e=>{var t;(0,d.$s)("follow_up_suggested_mode_button_shown",e.mode,{responseId:p.responseId,followUpSuggestedMode:null!=(t=e.mode)?t:"UNKNOWN"})},onUiLayout:e=>{eh=eh.map(t=>{var s;return{...t,uiLayout:{...null!=(s=t.uiLayout)?s:{},...e}}})}}),(e.token||e.messageTag)&&eT(),eC(p),eh[m]=p,r&&(p=this.processSoftStop({currentStreamResponse:p,responseChunk:e,startTimeMs:eb}),(0,d.$s)("generation_time_ms",p.generationTimeMs,{conversationId:ea.conversationId,responseId:p.responseId}),ex(p),eh.every(e=>"closed"===e.state)&&((0,d.$s)("finished_query",null==(s=eh[0])?void 0:s.responseId,{conversationId:ea.conversationId,toggledExperiment:ey.toString(),secondResponse:(null==(n=eh[1])?void 0:n.responseId)||"",isReasoning:T?T.toString():"",deepsearchPreset:k||""}),eh.forEach(ex),W(eh),ew=!0)),c&&(ew=!0)}}if(eS||(this.ensureUserResponseSaved({conversationId:ea.conversationId,message:c,userResponse:ed,onUserResponse:F,forceUpsertResponse:ex}).then(L(eh)).then(e=>eh=e).catch((0,a.HX)("response-store:useResponseStore:streamCreateAndRespond")),eS=!0),!ew){let e=Error(f.CZ);(0,a.vV)("response-store:useResponseStore:streamCreateAndRespond:closedStream",e)}(0,a.N8)("streamCreateAndRespond",{type:"send_query_stream_success",subscriptionTier:ei||"unknown",modelId:h,modelMode:(0,i.yv)({isReasoning:T,deepsearchPreset:k})})}).catch(e=>{(0,l.GQ)(e)&&((0,a.vV)("response-store:useResponseStore:streamCreateAndRespond",e),(0,a.N8)("streamCreateAndRespond",{type:"send_query_stream_error",subscriptionTier:ei||"unknown",modelId:h,modelMode:(0,i.yv)({isReasoning:T,deepsearchPreset:k})}));let t=K(e);if(E&&t)M(h,ea.conversationId,eh,T,k,D,G,Q,$,W,H).catch(e=>{throw(0,a.vV)("response-store:useResponseStore:streamCreateAndRespond:handleStreamError",e),e});else throw(eh=eh.map(e=>({...e,state:"error",liveThinkingEndTime:e.liveThinkingStartTime&&!e.liveThinkingEndTime?Date.now():e.liveThinkingEndTime,searchingEndTime:e.searchingStartTime&&!e.searchingEndTime?Date.now():e.searchingEndTime}))).forEach(ex),W(eh),e}).finally(()=>{e_()})},this.ensureUserResponseSaved=e=>{let{conversationId:t,message:s,userResponse:n,onUserResponse:o,forceUpsertResponse:i}=e;return this.get().addUserResponse(t,s).then(e=>(i(e),o(e),e)).catch(()=>{if(!n)return;let e={...n,state:"error"};return i(e),e})},this.abortStream=async(e,t)=>{let s=this.get(),n=x.w.getState(),o=s.byId[t];if(!o.state||!["streaming","error","reconnecting"].includes(o.state))return Promise.resolve(t);let i=n.abortControllerById[e];return i&&(i.abort(),n.removeAbortControllerById(e)),u.chatApi.chatStopConversationInflightResponses({conversationId:e}).then(()=>{let t={...o,responseId:o.inflightResponseId,conversationId:e,state:"closed",partial:!0,liveThinkingEndTime:o.liveThinkingStartTime&&!o.liveThinkingEndTime?Date.now():o.liveThinkingEndTime,searchingEndTime:o.searchingStartTime&&!o.searchingEndTime?Date.now():o.searchingEndTime};return s.upsertResponse(t),t.responseId}).catch(e=>{let t={...o,state:"error",liveThinkingEndTime:o.liveThinkingStartTime&&!o.liveThinkingEndTime?Date.now():o.liveThinkingEndTime,searchingEndTime:o.searchingStartTime&&!o.searchingEndTime?Date.now():o.searchingEndTime};throw s.upsertResponse(t),e})},this.addUserResponse=(e,t,s)=>u.chatApi.chatAddUserResponse({conversationId:e,body:{message:t,parentResponseId:s}}).then(t=>{let s=this.get(),n={...t,conversationId:e};return s.upsertResponse(n),n}),this.addToolResponse=(e,t)=>u.chatApi.chatAddToolResponse({body:{responseId:e,toolResponse:t}}).then(()=>{let s=this.get(),n=s.byId[e];if(n){let e={...n,toolResponses:[...n.toolResponses||[],t]};return s.upsertResponse(e),e}throw Error("Response not found in state")}),this.createVoiceUserMessage=e=>{let{userResponseId:t,conversationId:s,parentResponseId:n,message:o,onUserResponse:i,onOptimisticModelResponse:r}=e,a=this.get(),l=N({responseId:t,parentResponseId:n,message:o,conversationId:s,state:"closed",partial:!1});a.upsertResponse(l),i(l);let d=A({conversationId:s,responseId:"streaming_in_progress_".concat(y()()),parentResponseId:l.responseId,sender:"ASSISTANT",state:"streaming"});a.upsertResponse(d),r(d)}}}async function M(e,t,s,n,o,r,c,h,m,p,v){let f=P.getState(),I=x.w.getState(),y=R.x.getState().bestSubscription,S=s.map(e=>({...e,state:"reconnecting"}));S.forEach(f.upsertResponse);let w=e=>new Promise(t=>setTimeout(t,e));if(t.startsWith("optimistic_conversation_"))return void(S=S.map(e=>({...e,state:"error"}))).forEach(f.upsertResponse);let b={type:"milliseconds_per_token",subscriptionTier:y||"unknown",modelId:e,modelMode:(0,i.yv)({isReasoning:n,deepsearchPreset:o}),millisecondsPerTokenList:[]},{log:C,stop:_,resetTime:k}=(0,a.Pp)("handleStreamError",b);(0,a.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_start",subscriptionTier:y||"unknown",modelId:e,modelMode:(0,i.yv)({isReasoning:n,deepsearchPreset:o})});for(let s=1;s<=10;s++){try{let s=await f.fetchListInflightResponses(t,!0);if(s.length>0&&s[0].responseId&&S[0].parentResponseId){await u.chatApi.chatReconnectResponseV2Raw({responseId:s[0].responseId}).then(async l=>{var u,w,b,x,R,_,T,M,P,E,B,N,V,L,U,j,D,O,F;(0,a.N8)("handleStreamError",{type:"send_query_stream_reconnect_start",subscriptionTier:y||"unknown",modelId:e,modelMode:(0,i.yv)({isReasoning:n,deepsearchPreset:o})}),k();let q=g(l.raw);C();let G=await q.next();if(!(null==(u=G.value)?void 0:u.result)||!(null==(x=G.value)||null==(b=x.result)||null==(w=b.response)?void 0:w.modelResponse))throw Error("No initial state received from reconnect");let{title:Q,response:$}=G.value.result;if(Q){let e=I.byId[t];I.upsertAndCacheConversation({...e,title:Q.newTitle})}let W=A({...$.modelResponse,conversationId:t,responseId:S[0].responseId,parentResponseId:S[0].parentResponseId,sender:S[0].sender,state:"streaming",...s[0].createTime&&{createTime:s[0].createTime}});if(((null==(R=$.queryAction)?void 0:R.type)==="aurora"||(null==(_=$.queryAction)?void 0:_.type)==="flux")&&(W.hasImages=!0,m()),(null==(T=$.queryAction)?void 0:T.type)==="x"&&(W.hasSearches=!0),(null==(M=$.followUpSuggestions)?void 0:M.suggestions)&&(W.suggestions=$.followUpSuggestions.suggestions),$.followUpSuggestedMode&&(W.followUpSuggestedMode=$.followUpSuggestedMode),$.finalMetadata&&($.finalMetadata.followUpSuggestions&&(W.suggestions=$.finalMetadata.followUpSuggestions),$.finalMetadata.disclaimer&&h($.finalMetadata.disclaimer,W.conversationId)),$.cachedImageGenerationResponse&&$.cachedImageGenerationResponse.imageUrl&&(W.generatedImageUrls=W.generatedImageUrls.concat([$.cachedImageGenerationResponse.imageUrl])),$.cardAttachment&&$.cardAttachment.jsonData&&(W.cardAttachmentsJson=W.cardAttachmentsJson.concat([$.cardAttachment.jsonData])),(null==(E=$.modelResponse)||null==(P=E.steps)?void 0:P.length)&&(W.searchingStartTime=new Date(W.createTime).getTime(),(null==(U=$.modelResponse)?void 0:U.message)&&(W.searchingEndTime=Date.now())),$.bannerMessage&&$.bannerMessage.message&&h($.bannerMessage.message,W.conversationId),$.disclaimer&&$.disclaimer.message&&h($.disclaimer.message,W.conversationId),(null==(B=$.modelResponse)?void 0:B.thinkingTrace)&&(W.liveThinkingStartTime=new Date(W.createTime).getTime(),$.isThinking||W.liveThinkingEndTime||(W.liveThinkingEndTime=Date.now())),S=[W],f.upsertResponse(W),r(S),$.streamingImageGenerationResponse){let{imageId:e,imageUrl:t}=$.streamingImageGenerationResponse;if(e&&t){let s=null!=(j=W.streamingImageById)?j:{};$.streamingImageGenerationResponse.progress&&(W.streamingImageById={...s,[e]:{...null!=(D=s[e])?D:{},[$.streamingImageGenerationResponse.progress]:$.streamingImageGenerationResponse}}),f.setOneImageIdByUrl(e,t)}}((null==(N=W.webSearchResults)?void 0:N.length)||(null==(V=W.citedWebSearchResults)?void 0:V.length)||(null==(L=W.xposts)?void 0:L.length))&&c(W);let[H,K]=z(),J=new Date(W.createTime).getTime();for await(let e of q){if(C(),e.error){let t=Error(e.error.message);throw v(t),t}if(!e.result)continue;let{title:s,response:i}=e.result;if(null==s?void 0:s.newTitle){let e=I.byId[t];I.upsertAndCacheConversation({...e,title:s.newTitle})}if(i){if(null==(O=i.modelResponse)?void 0:O.error)throw(0,a.vV)("response-store:handleStreamError:modelResponse",i.modelResponse.error),Error(i.modelResponse.error);W={...f.processResponseChunk({currentStreamResponse:W,responseChunk:i,onCitations:()=>c(W),onHasImage:m,onDisclaimer:h,onFollowUpSuggestedMode:e=>{var t;(0,d.$s)("follow_up_suggested_mode_button_shown",e.mode,{responseId:W.responseId,followUpSuggestedMode:null!=(t=e.mode)?t:"UNKNOWN"})}}),parentResponseId:S[0].parentResponseId},H(W),S[0]=W,i.isSoftStop&&(W=f.processSoftStop({currentStreamResponse:W,responseChunk:i,startTimeMs:J}),(0,d.$s)("generation_time_ms",W.generationTimeMs,{conversationId:t,responseId:W.responseId}),K(W),S.every(e=>"closed"===e.state)&&((0,d.$s)("finished_query",null==(F=S[0])?void 0:F.responseId,{conversationId:t,isReasoning:n?n.toString():"",deepsearchPreset:o||""}),S.forEach(K),p(S,S.map(e=>e.responseId))))}}("streaming"===W.state||"reconnecting"===W.state)&&(W={...W,state:"closed",liveThinkingEndTime:W.liveThinkingStartTime&&!W.liveThinkingEndTime?Date.now():W.liveThinkingEndTime,searchingEndTime:W.searchingStartTime&&!W.searchingEndTime?Date.now():W.searchingEndTime},S[0]=W,K(W)),p(S,S.map(e=>e.responseId)),(0,a.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_success",subscriptionTier:y||"unknown",modelId:e,modelMode:(0,i.yv)({isReasoning:n,deepsearchPreset:o})}),(0,a.N8)("handleStreamError",{type:"send_query_stream_reconnect_success",subscriptionTier:y||"unknown",modelId:e,modelMode:(0,i.yv)({isReasoning:n,deepsearchPreset:o})})});break}(S=S.map(e=>({...e,state:"error",liveThinkingEndTime:e.liveThinkingStartTime&&!e.liveThinkingEndTime?Date.now():e.liveThinkingEndTime,searchingEndTime:e.searchingStartTime&&!e.searchingEndTime?Date.now():e.searchingEndTime}))).forEach(f.upsertResponse),(0,a.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_fail",subscriptionTier:y||"unknown",modelId:e,modelMode:(0,i.yv)({isReasoning:n,deepsearchPreset:o})});break}catch(t){if(_(),(0,a.vV)("response-store:handleStreamError:retryError",t),(0,l.GQ)(t)&&((0,a.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_error",subscriptionTier:y||"unknown",modelId:e,modelMode:(0,i.yv)({isReasoning:n,deepsearchPreset:o})}),(0,a.N8)("handleStreamError",{type:"send_query_stream_reconnect_error",subscriptionTier:y||"unknown",modelId:e,modelMode:(0,i.yv)({isReasoning:n,deepsearchPreset:o})})),10===s)throw(0,a.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_fail",subscriptionTier:y||"unknown",modelId:e,modelMode:(0,i.yv)({isReasoning:n,deepsearchPreset:o})}),(S=S.map(e=>({...e,state:"error"}))).forEach(f.upsertResponse),t;await w(2e3),(S=S.map(e=>({...e,state:"reconnecting"}))).forEach(f.upsertResponse)}_()}}let P=(0,c.y$)(T,"useResponseStore");function E(e,t){return P(s=>{var n;return e?null==(n=s.byId[e])?void 0:n[t]:void 0})}(0,c.lB)(P,"byId","byConversationId",(e,t)=>{let s=Object.values(e),n=P.getState().byConversationId,o=new Set(w()(s).filter(e=>e!==t[e.responseId]||!!e.state&&"closed"!==e.state).map(e=>e.conversationId).value()),i=s.filter(e=>o.has(e.conversationId)),r=b.A(e=>e.conversationId,i);return{...n,...w().pick(r,[...o.values()])}}),(0,c.lB)(P,"byId","nodesByConversationId",e=>{let t=P.getState().nodesByConversationId,s=!1,n={};for(let o in e){let i=e[o],r=i.conversationId,a=t[r]||[],l=a.find(e=>e.responseId===o);l?"streaming"===i.state&&l.parentResponseId!==i.parentResponseId&&(s=!0,n[r]=[...a,{...l,parentResponseId:i.parentResponseId}]):(s||(s=!0,n={...t}),n[r]?n[r]===a&&(n[r]=[...a]):n[r]=[...a],n[r].push({responseId:o,parentResponseId:i.parentResponseId,sender:i.sender}))}return s?n:t});let B=2;function N(e){return{sender:"human",createTime:new Date().toISOString(),manual:!1,partial:!0,shared:!1,isControl:!1,query:"",queryType:"",thinkingTrace:"",webSearchResults:[],xpostIds:[],xposts:[],generatedImageUrls:[],imageAttachments:[],imageEditUris:[],fileAttachments:[],cardAttachmentsJson:[],fileUris:[],fileAttachmentsMetadata:[],state:"optimistic",parentResponseId:"",parentQuotedText:void 0,steps:[],imageEditUri:"",error:"",mediaTypes:[],webpageUrls:[],citedWebSearchResults:[],metadata:{},uiLayout:{reasoningUiLayout:"UNSPECIFIED"},selectedFileTextContent:"",selectedFileTextContentStartPosition:0,selectedFileTextContentEndPosition:0,toolResponses:[],toolUsageResultById:{},traceSteps:[],...e}}function A(e,t,s){let n="default"===t?Date.now():void 0,o=s?Date.now():void 0;return{message:"",createTime:new Date().toISOString(),manual:!1,partial:!0,shared:!1,isControl:!1,query:"",queryType:"",thinkingTrace:"",webSearchResults:[],xpostIds:[],xposts:[],generatedImageUrls:[],imageAttachments:[],imageEditUris:[],fileAttachments:[],cardAttachmentsJson:[],fileUris:[],fileAttachmentsMetadata:[],state:"streaming",steps:[],imageEditUri:"",error:"",mediaTypes:[],webpageUrls:[],citedWebSearchResults:[],metadata:{},deepsearchPreset:t,generatedImageHeight:void 0,generatedImageWidth:void 0,...e,liveThinkingStartTime:o,searchingStartTime:n,selectedFileTextContent:"",selectedFileTextContentStartPosition:0,selectedFileTextContentEndPosition:0,uiLayout:{reasoningUiLayout:"UNSPECIFIED"},toolResponses:[],toolUsageResultById:{},traceSteps:[]}}function z(){let e,t={};return[s=>{if(!e){P.getState().upsertResponse(s),e=setTimeout(()=>{let s=Object.values(t);t={},s.length&&P.getState().appendResponses(s),e=void 0},30);return}t[s.responseId]=s},s=>{s&&(t[s.responseId]=s),clearTimeout(e);let n=Object.values(t);t={},n.length&&P.getState().appendResponses(n),e=void 0}]}function V(e){return e.liveThinkingStartTime||e.searchingStartTime||e.thinkingStartTime}function L(e){return t=>(t&&e.forEach(e=>{e.parentResponseId=t.responseId}),e)}function U(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={},s=[];for(let n of e){if(n.toolUsageResults)for(let e of n.toolUsageResults)e.toolUsageCardId&&(t[e.toolUsageCardId]=e);n.text&&n.tags&&w()(n.tags).zip(n.text).sortBy(e=>{var t;return null!=(t=j[e[0]||""])?t:3}).forEach(e=>{let[t,n]=e;if(n)switch(t){case"summary":{let e=n.match(/(- .*)|(<xai:tool_usage_card>[\s\S]*<\/xai:tool_usage_card>)/g);null==e||e.forEach(e=>{e.startsWith("-")?s.push({type:"summary",text:e}):s.push({type:"tool",text:e})});break}case"header":s.push({type:"header",text:n})}})}return{toolUsageResultById:t,traceSteps:s}}let j={header:0,summary:1,tool:1}},44347:(e,t,s)=>{s.d(t,{C$:()=>S,DC:()=>p,K2:()=>h,Qy:()=>g});var n=s(65258),o=s(88223),i=s(31352),r=s.n(i),a=s(96892),l=s.n(a),d=s(6132),c=s(4890),u=s(17823);let h={web_search:"web_search",google_web_search:"google_web_search",bing_web_search:"bing_web_search",web_search_with_snippets:"web_search_with_snippets",browse_page_with_js:"browse_page_with_js",browse_page_no_js:"browse_page_no_js",code_execution_training_parity:"code_execution_training_parity",get_x_user_handle:"get_x_user_handle",get_x_user_profile_pic_description:"get_x_user_profile_pic_description",x_post_lookup:"x_post_lookup",x_search:"x_search",x_keyword_search:"x_keyword_search",x_semantic_search:"x_semantic_search",get_top_us_news_from_x_trends:"get_top_us_news_from_x_trends",get_x_user_timeline:"get_x_user_timeline",get_x_bookmarks:"get_x_bookmarks",get_x_liked_posts:"get_x_liked_posts",render_x_posts:"render_x_posts",render_x_users:"render_x_users",render_card:"render_card"},m=d.z.object({model_name:d.z.string().nullish(),system_prompt_name:d.z.string().nullish(),enable_unified_layout:d.z.boolean().nullish(),tools_set:d.z.string().nullish(),system_turn_prompt:d.z.string().nullish(),tool_definition_prompt:d.z.string().nullish()}),p=d.z.object({promptMap:d.z.object({toolUseFc:d.z.string().nullish(),noToolUse:d.z.string().nullish(),toolUseSummarizer:d.z.string().nullish()}).nullish(),modelMap:d.z.object({noToolUse:d.z.string().nullish(),toolUse:d.z.string().nullish(),toolUseSummarizer:d.z.string().nullish(),imageGenModel:d.z.string().nullish(),imageEditModel:d.z.string().nullish()}).nullish(),useSingleModelEverything:d.z.boolean().nullish(),tools:d.z.record(d.z.nativeEnum(h),d.z.boolean()).nullish(),useToolOverrides:d.z.boolean().nullish(),sideBySideParams:m.array().nullish(),useSideBySideParams:d.z.boolean().nullish()});function g(e){let t=Object.values(null!=e?e:{});return!!t&&t.some(e=>"object"==typeof e&&e?Object.values(e).length>0:!e)}d.z.object({displayUserMessageMarkdown:d.z.boolean(),showFollowUpSuggestions:d.z.boolean(),autoWrapLongLinesCode:d.z.boolean(),browserNotificationsEnabled:d.z.boolean(),selectedSystemPromptId:d.z.string().optional(),showConversationPreviews:d.z.boolean().optional(),hideArtifacts:d.z.boolean().optional(),autoDetectWebpageAttachments:d.z.boolean(),showActiveTabs:d.z.boolean().optional(),disableTypeahead:d.z.boolean().optional(),disableAutoScroll:d.z.boolean().optional()});let v={displayUserMessageMarkdown:!1,showFollowUpSuggestions:!0,autoWrapLongLinesCode:!1,browserNotificationsEnabled:!1,selectedSystemPromptId:void 0,showConversationPreviews:!0,hideArtifacts:!1,autoDetectWebpageAttachments:!1,showActiveTabs:!0,disableTypeahead:!1,disableAutoScroll:!1},f={isIncognito:!1,userSettingsPromise:void 0,userSettings:{excludeFromTraining:!1,allowXPersonalization:!0,preferences:v,enableMemory:!0},selectedLanguage:void 0,showAgeVerification:!1,ageVerificationCallback:void 0,modelConfigOverride:void 0,modelConfigOverrideByModel:{}},I={excludeFromTraining:!0,allowXPersonalization:!1,preferences:v,enableMemory:!1};class y{constructor(e,t){this.set=e,this.get=t,this.isIncognito=f.isIncognito,this.userSettingsPromise=f.userSettingsPromise,this.userSettings=f.userSettings,this.selectedLanguage=f.selectedLanguage,this.showAgeVerification=f.showAgeVerification,this.ageVerificationCallback=f.ageVerificationCallback,this.modelConfigOverride=f.modelConfigOverride,this.modelConfigOverrideByModel=f.modelConfigOverrideByModel,this.isToolComposer2=f.isToolComposer2,this.sideBySideMode=f.sideBySideMode,this.setIsIncognito=(0,n.kp)(this.set,"isIncognito"),this.setUserSettingsPromise=(0,n.kp)(this.set,"userSettingsPromise"),this.setUserSettings=(0,n.kp)(this.set,"userSettings"),this.setSelectedLanguage=(0,n.kp)(this.set,"selectedLanguage"),this.setShowAgeVerification=(0,n.kp)(this.set,"showAgeVerification"),this.setAgeVerificationCallback=(0,n.kp)(this.set,"setAgeVerificationCallback"),this.setModelConfigOverrideByModel=(0,n.kp)(this.set,"modelConfigOverrideByModel"),this.setIsToolComposer2=(0,n.kp)(this.set,"isToolComposer2"),this.setSideBySideMode=(0,n.kp)(this.set,"sideBySideMode"),this.initializeGdprUserSettings=()=>o.aK.settingsGetUserSettings().then(e=>{let t=this.get();void 0===e.excludeFromTraining||void 0===e.enableMemory?t.fetchSetUserSettings(I).catch(console.error):t.setUserSettings(b(e,t.userSettings))}),this.initializeEnterpriseUserSettings=()=>o.aK.settingsGetUserSettings().then(e=>{let t=this.get();e.excludeFromTraining?t.setUserSettings(b(e,t.userSettings)):t.fetchSetUserSettings(I).catch(console.error)}),this.fetchGetUserSettings=()=>{let e=this.get();if(e.userSettingsPromise)return e.userSettingsPromise;let t=o.aK.settingsGetUserSettings().then(t=>b(t,e.userSettings));return e.setUserSettingsPromise(t),t.then(e.setUserSettings).catch(console.error),t},this.fetchSetUserSettings=e=>{let t=this.get();t.setUserSettings({...t.userSettings,...e});let s=o.aK.settingsSetUserSettings({body:e}).then(e=>b(e,this.get().userSettings));return t.setUserSettingsPromise(s),s.then(t.setUserSettings).catch(e=>{console.error(e)}),s},this.fetchSetPreference=(e,t)=>{let s=this.get();return s.fetchSetUserSettings({...s.userSettings,preferences:{...s.userSettings.preferences,[e]:t}})}}}let S=(0,c.v)()((0,u.lt)((0,u.eh)((0,u.Zr)((e,t)=>new y(e,t),{name:"settings-store",partialize:e=>({modelConfigOverrideByModel:e.modelConfigOverrideByModel,isToolComposer2:e.isToolComposer2,sideBySideMode:e.sideBySideMode}),version:2})),{name:"useSettingsStore"}));function w(e,t){return d.z.object({displayUserMessageMarkdown:d.z.boolean().catch(e.displayUserMessageMarkdown),showFollowUpSuggestions:d.z.boolean().catch(e.showFollowUpSuggestions),autoWrapLongLinesCode:d.z.boolean().catch(e.autoWrapLongLinesCode),browserNotificationsEnabled:d.z.boolean().catch(e.browserNotificationsEnabled),selectedSystemPromptId:d.z.string().optional().catch(e.selectedSystemPromptId),showConversationPreviews:d.z.boolean().optional().catch(e.showConversationPreviews),hideArtifacts:d.z.boolean().optional().catch(e.hideArtifacts),autoDetectWebpageAttachments:d.z.boolean().catch(e.autoDetectWebpageAttachments),showActiveTabs:d.z.boolean().optional().catch(e.showActiveTabs),disableTypeahead:d.z.boolean().optional().catch(e.disableTypeahead),disableAutoScroll:d.z.boolean().optional().catch(e.disableAutoScroll)}).catch(e).parse(t)}function b(e,t){let s=l()(e,r());return{...t,...s,preferences:w(t.preferences,e.preferences)}}(0,n.CP)(S,"userSettings","user-settings",f.userSettings,function(e){return e&&"object"==typeof e?{excludeFromTraining:f.userSettings.excludeFromTraining,allowXPersonalization:f.userSettings.allowXPersonalization,preferences:{...w(v,e.userSettings),disableTypeahead:!1},enableMemory:f.userSettings.enableMemory}:f.userSettings})},44845:(e,t,s)=>{s.d(t,{Ku:()=>i,TM:()=>o,ot:()=>a,yv:()=>r});var n=s(6132);let o=n.z.union([n.z.literal("none"),n.z.literal("unknown"),n.z.literal("deepsearch"),n.z.literal("deepersearch"),n.z.literal("think")]);function i(e){return"deepersearch"===e?"deeper":"deepsearch"===e?"default":void 0}function r(e){let{isReasoning:t,deepsearchPreset:s}=e;return t?"think":"deeper"===s?"deepersearch":"default"===s?"deepsearch":s?"unknown":"none"}function a(e){return"deepersearch"===e?"DEEPERSEARCH":"deepsearch"===e?"DEEPSEARCH":"think"===e?"REASONING":"DEFAULT"}},48992:(e,t,s)=>{s.d(t,{Cg:()=>l,Mb:()=>d,Po:()=>u,Wm:()=>function e(t,s){let n=t[s];if(!n)return s;let o=n[n.length-1];return o&&o.responseId?e(t,o.responseId):s},d7:()=>r,m$:()=>a,zp:()=>c});var n=s(38541),o=s.n(n),i=s(17703);function r(e,t,s){let n=o().keyBy(t,"responseId"),i=n[e];if(!i)return[];let r=[i],a=i.parentResponseId;for(;a&&(!s||r.length<s);){let e=n[a];if(!e)break;r.push(e),a=e.parentResponseId}return r}function a(e,t){let s;for(let n of e)if(t.find(e=>e.responseId===n.responseId))s=n;else break;return s}function l(e,t){let s=[],n=e,o=new Set;for(;n;){if(o.has(n.responseId||"")){(0,i.vV)("conversation-utils:getAncestorIds","Cycle detected in response hierarchy: ".concat(n.responseId));break}o.add(n.responseId||""),s.unshift(n.responseId||"");let e=n.parentResponseId;if(!e)break;n=t[e]}return s}function d(e){let t=new Set(e.map(e=>e.parentResponseId)),s=e.filter(e=>!t.has(e.responseId));if(0!==s.length)return o().maxBy(s,e=>e.createTime)}function c(e,t,s){if(!s)return!1;for(let n of r(s,t))if(n.responseId&&!e.some(e=>e.responseId===n.responseId))return!0;return!1}function u(e){if(!e||0===e.length)return 0;let t=new Set(e.map(e=>e.parentResponseId).filter(e=>e&&!(0,n.isEmpty)(e))),s=e.filter(e=>!t.has(e.responseId)),o=0;for(let t of s)o=Math.max(o,r(t.responseId,e).length);return o}},49972:(e,t,s)=>{s.d(t,{b:()=>w,w:()=>S});var n=s(2376),o=s(17703),i=s(65258),r=s(88223),a=s(94980),l=s(3275),d=s(74995),c=s(6230),u=s(23831),h=s(53915),m=s(3814),p=s(54542),g=s(98451),v=s(43893);function f(e){return{...e,personaId:(0,n._c)(e.systemPromptName),isNew:!1,state:"closed"}}let I=a.A(f);class y{constructor(e,t){this.set=e,this.get=t,this.promiseById={},this.byId={},this.list=[],this.abortControllerById={},this.listPromiseByQuery={},this.nextPageTokenByQuery={},this.upsertConversation=(0,i.el)(this.set,"byId","conversationId"),this.appendConversations=(0,i.BC)(this.set,"byId","conversationId"),this.removeConversation=(0,i.TF)(this.set,"byId"),this.setById=(0,i.kp)(this.set,"byId"),this.idsertConversationPromise=(0,i.q5)(this.set,"promiseById"),this.removeConversationPromise=(0,i.TF)(this.set,"promiseById"),this.setPromiseById=(0,i.kp)(this.set,"promiseById"),this.idsertAbortControllerById=(0,i.q5)(this.set,"abortControllerById"),this.removeAbortControllerById=(0,i.TF)(this.set,"abortControllerById"),this.setListPromiseByQuery=(0,i.kp)(this.set,"listPromiseByQuery"),this.idsertListPromiseByQuery=(0,i.q5)(this.set,"listPromiseByQuery"),this.idsertNextPageTokenByQuery=(0,i.q5)(this.set,"nextPageTokenByQuery"),this.upsertAndCacheConversation=(e,t)=>{let s=this.get();t&&t in s.byId&&t!==e.conversationId&&(s.removeConversation(t),s.removeConversationPromise(t)),s.upsertConversation(e),s.idsertConversationPromise(Promise.resolve(e),e.conversationId)},this.appendAndCacheConversations=e=>{let t=l.A(d.A("conversationId"),e),s=c.A(e=>Promise.resolve(e),t),{byId:n,promiseById:o}=this.get();this.set({byId:{...n,...t},promiseById:{...o,...s}})},this.fetchCreateConversation=e=>{var t;let s=this.get(),i=v.A3.getState(),a=r.chatApi.chatCreateConversation({body:e}).then(e=>({...e,personaId:(0,n._c)(e.systemPromptName),isNew:!0,state:"closed"})),l=null==(t=e.addResponseRequest)?void 0:t.conversationId;return l&&(s.idsertConversationPromise(a,l),i.nodesByConversationId[l]=[]),a.then(e=>{s.upsertConversation(e),s.idsertConversationPromise(a,e.conversationId),i.nodesByConversationId[e.conversationId]=[]}).catch((0,o.HX)("fetchCreateConversation")),a},this.fetchUpdateConversation=(e,t)=>{let s=this.get(),n=r.chatApi.chatUpdateConversation({conversationId:e,body:t}).then(t=>({...s.byId[t.conversationId]||{conversationId:e,isNew:!1,state:"closed"},...t})).then(u.A(s.upsertConversation)),i={...s.byId[e]||{conversationId:e,isNew:!1,state:"closed"},...t};return s.upsertConversation(i),s.idsertConversationPromise(Promise.resolve(i),e),n.then(()=>s.idsertConversationPromise(n,e)).catch((0,o.HX)("fetchUpdateConversation")),n},this.fetchDeleteConversation=e=>{let t=this.get(),s=r.chatApi.chatDeleteConversation({conversationId:e});return t.removeConversation(e),t.removeConversationPromise(e),t.setListPromiseByQuery(c.A(t=>t.then(t=>t.filter(t=>t.conversation.conversationId!==e)),t.listPromiseByQuery)),s},this.fetchSoftDeleteConversation=e=>{let t=this.get(),s=r.chatApi.chatSoftDeleteConversation({conversationId:e});return t.removeConversation(e),t.removeConversationPromise(e),s},this.fetchGetConversation=e=>{let t=this.get();if(e in t.promiseById)return t.promiseById[e];let s=r.chatApi.chatGetConversation({conversationId:e,includeWorkspaces:!0,includeTaskResult:!0}).then(f);return t.set(h.A(m.A(["promiseById",e]),s)),s.then(t.upsertConversation).catch(console.error),s},this.fetchGetManyConversations=e=>{let t=this.get(),s={},n=[];if(e.forEach(e=>{e in t.promiseById?s[e]=t.promiseById[e]:n.push(e)}),0===n.length)return Promise.all(Object.values(s));let o=n.length>0?r.chatApi.chatGetConversations({conversationIds:n,includeWorkspaces:!0,includeTaskResult:!0}).then(e=>{let{conversations:t}=e;return t||[]}).then(I):Promise.resolve([]);return o.then(e=>{e.forEach(e=>{let s=Promise.resolve(e);t.idsertConversationPromise(s,e.conversationId)}),t.appendConversations(e)}).catch(console.error),Promise.all([...Object.values(s),o.then(e=>e||[])]).then(e=>e.flat())},this.fetchListConversations=(e,t)=>{let s=this.get(),n=JSON.stringify(function e(t){if(null===t||"object"!=typeof t)return t;if(Array.isArray(t))return t.map(e);let s=Object.keys(t).sort(),n={};for(let o of s)n[o]=e(t[o]);return n}(p.A(e=>!!e,e||{})),null,void 0);if(!t&&n in s.listPromiseByQuery)return s.listPromiseByQuery[n];let o=t?s.nextPageTokenByQuery[n]:void 0,i=r.chatApi.chatListConversations({pageSize:"60",pageToken:o,...e}).then(e=>{let{conversations:t,textSearchMatches:o,nextPageToken:i}=e;return(i&&s.idsertNextPageTokenByQuery(i,n),null==o?void 0:o.length)?o.map(e=>{if(e.conversation)return{...e,conversation:f(e.conversation)}}):(null==t?void 0:t.length)?t.map(e=>({conversation:f(e)})):[]}).then(e=>e.filter(e=>!!e)).then(u.A(e=>{s.appendConversations(e.map(e=>e.conversation)),s.setPromiseById(c.A(e=>Promise.resolve(e.conversation),l.A(e=>e.conversation.conversationId,e)))}));if(t){let e=s.listPromiseByQuery[n];if(e)return Promise.all([e,i]).then(g.A);s.idsertListPromiseByQuery(i,n)}else s.idsertListPromiseByQuery(i,n);return i},this.fetchSoftDeleteAllConversations=()=>(this.setById({}),this.setPromiseById({}),r.chatApi.chatSoftDeleteAllConversations())}}let S=(0,i.y$)(y,"useConversationStore");function w(e){let t=new Date().toISOString();return{title:"New conversation",createTime:t,modifyTime:t,starred:!1,temporary:!1,isNew:!0,state:"optimistic",mediaTypes:[],workspaces:[],taskResult:{},...e}}(0,i.lB)(S,"byId","list",Object.values)},56096:(e,t,s)=>{s.d(t,{x:()=>i});var n=s(65258);class o{constructor(e,t){this.set=e,this.get=t}}let i=(0,n.y$)(o,"useSubscriptionsStore")},56691:(e,t,s)=>{s.d(t,{$n:()=>c,gx:()=>u,ru:()=>d});var n=s(79342),o=s(7287),i=s(17338),r=s(88382),a=s(61312),l=s(61884);let d=(0,i.F)(["inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium leading-[normal] cursor-pointer","focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:opacity-60 disabled:cursor-not-allowed","transition-colors duration-100","[&_svg]:shrink-0","select-none"],{variants:{variant:{filled:"bg-button-filled text-fg-invert hover:bg-button-filled-hover disabled:hover:bg-button-filled",filledSecondary:"bg-surface-l2 text-fg-secondary hover:bg-surface-l4-hover dark:hover:bg-surface-l3 border border-border-l1 disabled:hover:bg-surface-l2 dark:disabled:hover:bg-surface-l2",outline:"border border-border-l2 text-fg-primary hover:bg-button-ghost-hover [&_svg]:hover:text-fg-primary disabled:hover:bg-transparent",ghost:"text-fg-primary hover:bg-button-ghost-hover disabled:hover:bg-transparent border border-transparent",ghostSecondary:"text-fg-secondary hover:text-fg-primary hover:bg-button-ghost-hover disabled:hover:text-fg-secondary disabled:hover:bg-transparent [&_svg]:hover:text-fg-primary",text:"text-fg-primary bg-transparent hover:text-fg-secondary disabled:hover:text-fg-primary",textSecondary:"text-secondary bg-transparent hover:text-primary disabled:hover:text-fg-secondary",sticky:"text-fg-secondary hover:text-fg-primary disabled:hover:text-fg-secondary bg-surface-l1 dark:bg-surface-l2 dark:hover:bg-surface-l3 hover:bg-surface-l4-hover disabled:hover:bg-surface-l1 dark:disabled:hover:bg-surface-l2",none:"",primary:"bg-button-primary text-background hover:bg-button-primary-hover",secondary:"bg-button-secondary text-primary hover:bg-button-secondary-hover",accent:"bg-sunset/90 text-ivory hover:bg-sunset",card:"ring-1 ring-inset ring-toggle-border bg-card hover:bg-card-hover text-primary",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",link:"text-primary underline-offset-4 hover:underline"},size:{xs:"h-6 rounded-lg px-2.5 text-xs",sm:"h-8 rounded-xl px-3 text-xs",md:"h-10 rounded-xl px-3.5 py-2 text-sm",lg:"h-12 rounded-2xl px-5",iconXs:"h-6 w-6 rounded-lg",iconSm:"h-8 w-8 rounded-lg",iconMd:"h-10 w-10 rounded-xl",iconLg:"h-12 w-12 rounded-2xl",none:"",iconXl:"h-10 w-10 rounded-full",pill:"h-9 rounded-full px-3.5 py-2",nav:"h-8 rounded-xl px-3.5 text-sm font-medium",icon:"h-10 w-10 rounded-xl",default:"h-9 px-4 py-2 rounded-lg",noPadding:"h-9 rounded-lg"},rounded:{true:"rounded-full",false:null},btnColor:{default:null,danger:null},overideIconStyle:{true:"[&_svg]:text-inherit [&_svg]:hover:text-inherit",false:null}},compoundVariants:[{variant:"filled",btnColor:"danger",className:"text-white bg-red-500 hover:bg-red-400 disabled:hover:bg-red-500"},{variant:"filledSecondary",btnColor:"danger",className:"text-red-400 dark:text-red-300 hover:text-red-500 dark:text-red-200"},{variant:["outline","ghost","ghostSecondary","text"],btnColor:"danger",className:"text-red-400 dark:text-red-300 hover:text-red-500 dark:text-red-200 hover:bg-red-400/10"}],defaultVariants:{variant:"none",size:"md",rounded:!1,btnColor:"default"}}),c=r.forwardRef((e,t)=>{let{className:s,variant:i,size:r,btnColor:l="default",rounded:c=!1,asChild:u=!1,overideIconStyle:h=!1,...m}=e,p=u?o.DX:"button";return(0,n.jsx)(p,{className:(0,a.cn)(d({variant:i,size:r,rounded:c,btnColor:l,overideIconStyle:h,className:s})),ref:t,type:"button",...m})});c.displayName="Button";let u=r.forwardRef((e,t)=>{let{className:s,variant:i,size:r,btnColor:c="default",rounded:u=!1,asChild:h=!1,overideIconStyle:m=!1,tooltipProps:p={},tooltipContent:g,tooltipContentProps:v={},tooltipAsChild:f,stayOpenOnClick:I=!1,...y}=e,S=h?o.DX:"button",w=y["aria-label"];return void 0===w&&"string"==typeof g&&(w=g),(0,n.jsxs)(l.m_,{delayDuration:100,...p,children:[(0,n.jsx)(l.k$,{asChild:!0,onClick:I?e=>e.preventDefault():void 0,children:(0,n.jsx)(S,{className:(0,a.cn)(d({variant:i,size:r,rounded:u,btnColor:c,overideIconStyle:m,className:s})),ref:t,type:"button","aria-label":w,...y})}),g?(0,n.jsx)(l.ZI,{onPointerDownOutside:I?e=>e.preventDefault():void 0,...v,children:g}):null]})});u.displayName="ButtonWithTooltip"},58192:(e,t,s)=>{s.d(t,{E8:()=>r,Sk:()=>n,Wl:()=>i,fG:()=>a,oQ:()=>o});let n="grok-3",o="Grok 3",i="Grok 3",r="grok-3",a="Grok 2"},61312:(e,t,s)=>{s.d(t,{cn:()=>i});var n=s(40409),o=s(19967);function i(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,o.QP)((0,n.$)(t))}},61884:(e,t,s)=>{s.d(t,{Bc:()=>a,Gv:()=>u,ZI:()=>c,k$:()=>d,m_:()=>l});var n=s(79342),o=s(40251),i=s(88382),r=s(61312);let a=o.Kq,l=o.bL,d=o.l9,c=i.forwardRef((e,t)=>{let{className:s,sideOffset:i=4,disableAnimation:a,container:l,...d}=e;return(0,n.jsx)(o.ZL,{container:l,children:(0,n.jsx)(o.UC,{ref:t,collisionPadding:{top:16,right:16,bottom:16,left:16},sideOffset:i,className:(0,r.cn)("z-50 overflow-hidden rounded-md bg-popover shadow-sm dark:shadow-none px-3 py-1.5","text-xs text-popover-foreground pointer-events-none","max-w-80 text-wrap",a?"":(0,r.cn)("animate-in fade-in-0 zoom-in-95","data-[state=closed]:animate-out","data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95","data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2","data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2"),s),...d})})});c.displayName=o.UC.displayName;let u=(0,r.cn)("z-50 overflow-hidden rounded-2xl bg-primary text-primary-foreground","shadow-sm dark:shadow-none text-xs animate-in fade-in-0 zoom-in-95","data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95","data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 p-3");c.displayName=o.UC.displayName},65258:(e,t,s)=>{s.d(t,{BC:()=>S,CP:()=>b,L$:()=>p,MQ:()=>x,TF:()=>g,WQ:()=>h,_q:()=>k,dX:()=>m,el:()=>v,gN:()=>I,kp:()=>u,lB:()=>w,oQ:()=>y,ok:()=>_,q5:()=>f,y$:()=>C});var n=s(85431),o=s(3275),i=s(74995),r=s(53915),a=s(46815),l=s(4890),d=s(17823),c=s(76328);function u(e,t){return s=>{e(e=>({...e,[t]:s}),void 0,"assign:".concat(R(arguments)))}}function h(e,t){return s=>{e(e=>({...e,[t]:[...e[t]||[],s]}),void 0,"add:".concat(R(arguments)))}}function m(e,t,s){return()=>{e(e=>({...e,[t]:s}),void 0,"presign:".concat(R(arguments)))}}function p(e,t){return()=>{e(e=>({...e,[t]:!e[t]}),void 0,"toggle:".concat(R(arguments)))}}function g(e,t){return s=>{e(e=>({...e,[t]:n.A([s],e[t])}),void 0,"remove:".concat(R(arguments)))}}function v(e,t,s){return n=>{e(e=>({...e,[t]:{...e[t],...o.A(i.A(s),[n])}}),void 0,"upsert:".concat(R(arguments)))}}function f(e,t){return(s,n)=>{e(e=>({...e,[t]:{...e[t],[n]:s}}),void 0,"idsert:".concat(R(arguments)))}}function I(e,t){return(s,n)=>{e(e=>({...e,[t]:{...e[t],[n]:[...e[t][n]||[],s]}}),void 0,"lisert:".concat(R(arguments)))}}function y(e,t,s){return(n,o)=>{let i=!1;return e(e=>{var r;return{...e,[t]:{...e[t],[n]:null==(r=e[t][n])?void 0:r.filter(e=>{let t=e[s]!==o;return t||(i=!0),t})}}},void 0,"delist:".concat(R(arguments))),i}}function S(e,t,s){return n=>{e(e=>({...e,[t]:{...e[t],...o.A(i.A(s),n)}}),void 0,"append:".concat(R(arguments)))}}function w(e,t,s,n){let{subscribe:o,setState:l}=e;return o(i.A(t),(e,t)=>{l(r.A(a.A(s),n(e,t)))},{fireImmediately:!0})}function b(e,t,s,n,o){let{subscribe:l,setState:d}=e;try{let e=localStorage.getItem(s);if(null!=e){let s=JSON.parse(e);if(o){let e=o(s);d(r.A(a.A(t),e))}else d(r.A(a.A(t),s))}}catch(e){localStorage.setItem(s,JSON.stringify(n))}l(i.A(t),e=>{localStorage.setItem(s,JSON.stringify(e))})}function C(e,t){return(0,l.v)()((0,d.lt)((0,d.eh)((t,s)=>new e(t,s)),{name:t,store:t}))}function x(e,t){return(0,l.v)()((0,d.lt)((0,d.eh)((0,c.D)((t,s)=>({...new e(t,s)}))),{name:t,store:t}))}function R(e){return String([...e].slice(1))}function _(e){return{data:e,status:"success",error:null}}function k(e){return{data:null,status:"error",error:e instanceof Error?e:Error("unknown error")}}},68332:(e,t,s)=>{s.d(t,{o:()=>m});var n=s(38614),o=s(41739),i=s(17703),r=s(84499),a=s(49972),l=s(39116),d=s(12110),c=s(88382);let u=[new d.w("/chat/:chatId"),new d.w("/chat"),new d.w("/")],h=new d.w("/share/:shareLinkId");function m(){let e=(0,l.useRouter)(),t=(0,l.usePathname)(),{push:s}=(0,r.wK)(),d=(0,c.useMemo)(()=>!!t&&u.some(e=>e.test(t)),[t]),m=(0,c.useMemo)(()=>!!t&&h.test(t),[t]),p=(0,c.useMemo)(()=>{if(m){var e;return{shareLinkId:null==(e=h.test(t))?void 0:e.shareLinkId}}},[m,t]),g=(0,c.useCallback)((t,r,l)=>{let c=n.aP.getState();c.setConversationId(t),c.setSidePanelContent(void 0);let{fetchGetConversation:u,byId:h}=a.w.getState();if(t&&l){let e=o.a.getState();u(t).then(e.upsertConversationAsTab).catch((0,i.HX)("use-chat-router:routeToConversation:addToTabs"))}if(!r)if(t){var m,p;let n=null!=(p=null==(m=h[t])?void 0:m.temporary)&&p;s({page:"chat",conversationId:t,temporary:n}),d||e.push("/chat/".concat(t))}else s({page:"main"})},[d,s,e]);return{isChatPage:d,isSharePage:m,pageData:p,routeToConversation:g,signInWithReturnTo:(0,c.useCallback)((s,n)=>{let o=new URLSearchParams({q:s||"",reasoningMode:n||"none"}).toString(),i=o?"".concat(t,"?").concat(o):t,r=i?new URLSearchParams({return_to:i}).toString():void 0;e.push("/sign-in".concat(r?"?".concat(r):""))},[e,t])}}},69648:(e,t,s)=>{s.d(t,{w:()=>a});var n=s(79342),o=s(90808),i=s(88382),r=s(61312);let a=i.forwardRef((e,t)=>{let{className:s,orientation:i="horizontal",decorative:a=!0,...l}=e;return(0,n.jsx)(o.b,{ref:t,decorative:a,orientation:i,className:(0,r.cn)("shrink-0 bg-border","horizontal"===i?"h-[1px] w-full":"h-full w-[1px]",s),...l})});a.displayName=o.b.displayName},70888:(e,t,s)=>{s.d(t,{x:()=>c});var n=s(17703),o=s(65258),i=s(88223),r=s(14908),a=s(86530).hp;let l={listByConversationId:{},fileMetaPromiseById:{},fileMetaById:{},attachListByConversationId:{}};class d{constructor(e,t){this.set=e,this.get=t,this.listByConversationId=l.listByConversationId,this.fileMetaPromiseById=l.fileMetaPromiseById,this.fileMetaById=l.fileMetaById,this.attachListByConversationId=l.attachListByConversationId,this.lisertByConversationId=(0,o.gN)(this.set,"listByConversationId"),this.removeByConversationId=(0,o.TF)(this.set,"listByConversationId"),this.delistByConversationId=(0,o.oQ)(this.set,"listByConversationId","file"),this.upsertFileMetadata=(0,o.el)(this.set,"fileMetaById","fileMetadataId"),this.idsertFileMetadataPromise=(0,o.q5)(this.set,"fileMetaPromiseById"),this.lisertAttachByConversationId=(0,o.gN)(this.set,"attachListByConversationId"),this.removeAttachByConversationId=(0,o.TF)(this.set,"attachListByConversationId"),this.delistAttachByConversationId=(0,o.oQ)(this.set,"attachListByConversationId","assetId"),this.fetchUploadFile=(e,t)=>{let s=this.get(),o=e.arrayBuffer().then(t=>i.chatApi.chatUploadFile({body:{fileName:e.name,fileMimeType:e.type,content:a.from(t).toString("base64")}}).then(e=>e).catch(e=>{if(e.message.includes("OUT_OF_RANGE"))throw Error("File was too large.");throw e})),r={file:e,metadataPromise:o};return s.lisertByConversationId(r,t),o.then(n=>{s.delistByConversationId(t,e)&&s.lisertByConversationId({...r,metadata:n},t)}).catch(o=>{s.delistByConversationId(t,e)&&(s.lisertByConversationId({...r,metadata:o},t),(0,n.vV)("fetchUploadFile",o))}),r},this.fetchFileMetadata=e=>{let t=this.get();if(e in t.fileMetaById)return Promise.resolve(t.fileMetaById[e]);if(e in t.fileMetaPromiseById)return t.fileMetaPromiseById[e];let s=i.chatApi.chatGetFileMetadata({fileMetadataId:e}).then(e=>e);return t.idsertFileMetadataPromise(s,e),s.then(t.upsertFileMetadata),s},this.fetchAttachThirdPartyFile=(e,t,s,o,a)=>{let l=this.get(),d=i.chatApi.chatUploadFile({body:{fileName:e,fileMimeType:t,fileSource:s,thirdPartyFileId:o}}).then(e=>e).catch(e=>{if(e.message.includes("OUT_OF_RANGE"))throw Error("File was too large.");throw e}),c=new File([o],e),u={file:c,metadataPromise:d};return l.lisertByConversationId(u,a),d.then(e=>{l.delistByConversationId(a,c)&&l.lisertByConversationId({...u,metadata:e},a)}).catch(e=>{l.delistByConversationId(a,c)&&(l.lisertByConversationId({...u,metadata:e},a),(0,n.vV)("fetchAttachThirdPartyFile",e)),e.message&&r.oR.error(e.message)}),u}}}let c=(0,o.y$)(d,"useFileStore")},83626:(e,t,s)=>{function n(e){let t=!1;return()=>{t||(e(),t=!0)}}function o(e,t){if(void 0!==e)return t(e)}s.d(t,{F:()=>o,S:()=>n})},84499:(e,t,s)=>{s.d(t,{KQ:()=>E,N_:()=>k,wK:()=>T});var n=s(79342),o=s(38614),i=s(61884),r=s(17703),a=s(44347),l=s(39116),d=s(12110),c=s(88382),u=s(61657);let h=["conversations","attachments"],m=["name","size","used","created"],p="used",g=["image","document","spreadsheet","code","pdf"],v=["user","grok"],f=new d.w("/files"),I=new d.w("/workspace"),y=new d.w("/workspace/:id"),S=new d.w("/project"),w=new d.w("/project/:id"),b=new d.w("/chat/:id"),C=new d.w("/chat"),x=new d.w("/images"),R=new d.w("/tasks");function _(e,t){switch(e.page===t.page&&(e=function(e){let t={...e};for(let e of Object.keys(t))void 0===t[e]&&delete t[e];return t}(e),e={...t,...e}),e.page){case"main":case"unknown":return{pathname:"/"};case"files":return{pathname:"/files",query:{file:e.fileId||void 0,emptyView:"default"===e.emptyView?void 0:e.emptyView,search:e.search||void 0,sort:e.sort===p?void 0:e.sort,fileType:e.fileType,createdBy:e.createdBy}};case"workspaces":return{pathname:"/project"};case"workspace":return{pathname:"/project/"+e.workspaceId,query:{tab:"attachments"!==e.tab?e.tab:void 0}};case"chat":if(e.temporary)return{pathname:"/chat"};if(!e.conversationId)return{pathname:"/"};return{pathname:"/chat/"+e.conversationId};case"images":return{pathname:"/images".concat(e.tab?"/".concat(e.tab):"")};case"tasks":return{pathname:"/tasks",query:{taskId:e.taskId||void 0,tab:e.tab||void 0}};case"plans":return{pathname:"/plans"};default:let s=e;return(0,r.vV)("routeToUrlObject","Unhandled route case:"+s),{}}}let k=(0,c.forwardRef)((e,t)=>{let{route:s,onClick:r,tooltip:d,tooltipContentProps:u,showTooltip:h=!0,...m}=e,{route:p}=T(),g=(0,c.useMemo)(()=>P(_(s,p)),[JSON.stringify(s),JSON.stringify(p)]),v=(0,l.useRouter)(),{route:f}=T(),I=(0,c.useCallback)(e=>{var t;if(null==r||r(e),!function(e){let t=e.currentTarget.getAttribute("target");return t&&"_self"!==t||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||2===e.button}(e)&&(e.preventDefault(),null==(t=globalThis)||t.window.history.pushState({},"",g),("unknown"===f.page||"unknown"===s.page)&&v.push(g),"main"===s.page)){let{setIsIncognito:e}=a.C$.getState();if(e(!1),"chat"===p.page){let{setOptimisticConversationId:e,setConversationId:t,setSidePanelContent:s}=o.aP.getState();e(void 0),t(void 0),s(void 0)}}},[f.page,v,r,s.page,g,p.page]);return d?(0,n.jsxs)(i.m_,{children:[(0,n.jsx)(i.k$,{asChild:!0,children:(0,n.jsx)("a",{...m,onClick:I,href:g,ref:t})}),h&&(0,n.jsx)(i.ZI,{...u,children:d})]}):(0,n.jsx)("a",{...m,onClick:I,href:g,ref:t})});function T(){let e=(0,l.usePathname)(),t=(0,l.useSearchParams)(),s=(0,c.useMemo)(()=>(function(e,t){var s,n,o,i,r;if("/"===e)return{page:"main"};if(f.test(e))return{page:"files",fileId:t.get("file")||null,emptyView:"image"===t.get("emptyView")?"image":"default",search:t.get("search")||void 0,sort:null!=(s=M(m,t.get("sort")))?s:p,fileType:M(g,t.get("fileType")),createdBy:M(v,t.get("createdBy"))};if(I.test(e)||S.test(e))return{page:"workspaces"};let a=y.test(e);if(null==a?void 0:a.id){let e=null!=(n=t.get("tab"))?n:"";return{page:"workspace",workspaceId:a.id,tab:null!=(o=M(h,e))?o:"attachments"}}let l=w.test(e);if(null==l?void 0:l.id){let e=null!=(i=t.get("tab"))?i:"";return{page:"workspace",workspaceId:l.id,tab:null!=(r=M(h,e))?r:"attachments"}}let d=b.test(e);return(null==d?void 0:d.id)?{page:"chat",conversationId:d.id,temporary:!1}:C.test(e)?{page:"chat",conversationId:null,temporary:!0}:x.test(e)?{page:"images"}:R.test(e)?{page:"tasks",taskId:t.get("taskId"),tab:t.get("tab")}:{page:"unknown"}})(e,t),[e,t.toString()]),n=(0,c.useCallback)(e=>{var t;let n=P(_(e,s));null==(t=globalThis)||t.window.history.pushState({},"",n)},[s]),o=(0,c.useCallback)(e=>{var t;let n=P(_(e,s));null==(t=globalThis)||t.window.history.replaceState({},"",n)},[s]);return(0,c.useMemo)(()=>({push:n,replace:o,route:s}),[n,o,s])}function M(e,t,s){return e.includes(t)?t:s}function P(e){if(e.query&&"string"!=typeof e.query)for(let t in e.query)void 0===e.query[t]&&delete e.query[t];return(0,u.format)(e)}function E(e,t){let s=P(_(e,e));return"".concat(t).concat(s)}},98100:(e,t,s)=>{s.d(t,{I2:()=>b,$E:()=>I,QG:()=>y,GB:()=>S});var n=s(38614),o=s(58192),i=s(6132);let r=i.z.object({modelId:i.z.string(),name:i.z.string().optional(),description:i.z.string().optional(),tags:i.z.array(i.z.string()).optional(),badgeText:i.z.string().optional()});i.z.object({models:i.z.array(r).optional().default([]),defaultFreeModel:i.z.string().optional(),defaultProModel:i.z.string().optional(),unavailableModels:i.z.array(r).optional().default([]),defaultAnonModel:i.z.string().optional()});let a=e=>["get-models",e];var l=s(88223),d=s(70888),c=s(13511),u=s(61683),h=s(38541),m=s.n(h),p=s(74995),g=s(3275),v=s(88382),f=s(75500);function I(){let e=(0,f.h)();return(0,v.useMemo)(()=>e.FORCE_SIGN_IN_MODELS.value.forceSignInModels&&Array.isArray(e.FORCE_SIGN_IN_MODELS.value.forceSignInModels)?e.FORCE_SIGN_IN_MODELS.value.forceSignInModels:[],[e.FORCE_SIGN_IN_MODELS.value])}function y(e){var t,s;let o=(0,d.x)(p.A("listByConversationId")),i=(0,d.x)(p.A("attachListByConversationId")),r=(0,n.aP)(p.A("conversationId"))||"no_conversation_id",a=(0,n.aP)(p.A("reasoningMode")),l="deepsearch"==a||"deepersearch"==a,c="think"==a,u=o[r],h=i[r],m=((null==u?void 0:u.length)||0)+((null==h?void 0:h.length)||0),g=null==e||null==(t=e.tags)?void 0:t.includes("no_attachments_for_think"),f=null==e||null==(s=e.tags)?void 0:s.includes("no_attachments_for_deepsearch"),I=!!(m&&g),y=!!(m&&f);return{isAttachDisabled:(0,v.useMemo)(()=>!!g&&!!c||!!f&&!!l,[l,c,g,f]),isThinkDisabled:I,isDeepsearchDisabled:y,isThinkSelected:c,isDeepsearchSelected:l}}function S(){var e,t,s,n;let i=u.Ay.language,d=(0,f.h)(),{data:h,isPending:I}=(0,c.IT)({queryKey:a(i),queryFn:async()=>{var e;return{models:((e=await l.FI.modelsGetModels({body:{locale:i}})).models||[]).map(e=>r.safeParse(e)).filter(e=>e.success).map(e=>e.data).sort((e,t)=>e.name===o.Wl?-1:t.name===o.Wl||e.name===o.fG?1:t.name===o.fG?-1:0),unavailableModels:(e.unavailableModels||[]).map(e=>r.safeParse(e)).filter(e=>e.success).map(e=>e.data),defaultAnonModelId:e.defaultAnonModel,defaultFreeModelId:e.defaultFreeModel,defaultProModelId:e.defaultProModel}},staleTime:3e5}),y=(0,v.useMemo)(()=>{var e;if(!h)return[];let t=R.safeParse(d.GROK35_FLEXIBLE_INPUT.value),s=new Set(null==(e=C.safeParse(d.HIDE_MODELS.value).data)?void 0:e.hideModels);return m().sortBy(h.models.filter(e=>!s.has(e.modelId)),"name").map(e=>({...e,...w(e.modelId,t)}))},[h,d.HIDE_MODELS,d.GROK35_FLEXIBLE_INPUT]),S=(0,v.useMemo)(()=>y?g.A(p.A("modelId"),y):{},[y]);return{models:y,unavailableModels:null!=(e=null==h?void 0:h.unavailableModels)?e:[],defaultAnonModelId:null!=(t=null==h?void 0:h.defaultAnonModelId)?t:o.Sk,defaultFreeModelId:null!=(s=null==h?void 0:h.defaultFreeModelId)?s:o.Sk,defaultProModelId:null!=(n=null==h?void 0:h.defaultProModelId)?n:o.Sk,modelById:S,isPending:I}}function w(e,t){var s,n,o,i,r,a,l,d;let c={modelId:e};return(null==(n=t.data)||null==(s=n[e])?void 0:s.name_override)&&(c.name=null==(a=t.data)||null==(r=a[e])?void 0:r.name_override),(null==(i=t.data)||null==(o=i[e])?void 0:o.description_override)&&(c.description=null==(d=t.data)||null==(l=d[e])?void 0:l.description_override),c}function b(e,t){return w(e,R.safeParse(t.GROK35_FLEXIBLE_INPUT.value))}let C=i.z.object({hideModels:i.z.array(i.z.string())}),x=i.z.object({name_override:i.z.string().nullish(),description_override:i.z.string().nullish()}).catch({}),R=i.z.record(i.z.string(),x).catch({})}}]);